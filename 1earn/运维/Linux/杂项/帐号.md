# 账号

---

## Reference

- [系统加固之Linux安全加固](https://mp.weixin.qq.com/s/cj2IpePACewH2wqXFgKTDw)

---

# 用户信息

**/etc/passwd**

- 存储条目格式

    ```
    name:coded-passwd:UID:GID:userinfo:homedirectory:shell

    例子
    root:x:0:0:root:/root:/usr/bin/bash
    |    | | |  |     |        |__登录 shell 程序的路径
    |    | | |  |     |__宿主目录
    |    | | |  |__用户全民
    |    | | |__所属基本组的GID号
    |    | |__用户账号的UID号
    |    |__密码字串或占位符x
    |__用户账号的名称
    ```

    - 若用户ID=0，则表示该用户拥有超级用户的权限
    - 检查是否有多个ID=0
    - 禁用或删除多余的账号
    - 系统默认用户    系统程序使用，从不登录
    - 新建普通用户    uid 大于 500

**/etc/shadow**

- 存储条目格式

    ```
    name:passwd:lastchg:min:max:warn:inactive:expire:flag

    例子
    root:$6$pglAPwtWL....K6EMWC6sP8dqMh3TB2C21::0:99999:7:::
    |                       |                 | |   |   ||||__保留字段(未使用)
    |                       |                 | |   |   |||__账号失效时间,默认值未空
    |                       |                 | |   |   ||__密码过期后多少天禁用此用户账号
    |                       |                 | |   |   |__密码过期前的警告天数,默认7
    |                       |                 | |   |__密码的最长有效天数,默认99999
    |                       |                 | |__密码的最短有效天数,默认0
    |                       |                 |__上次修改密码的时间
    |                       |__加密后的密码字符串
    |__用户账号的名称
    ```

**用户管理**
```bash
id                          # 当前用户
whoami	                    # 当前用户
groups	                    # 当前组

useradd -d /home/<用户名> -s /sbin/nologin <用户名> # 创建用户
passwd <用户名>             # 设置用户密码

addgroup <组名>             # 创建组
addgroup <用户名> <组名>    # 移动用户到组

newgrp <组名>               # 创建组

usermod -g <组名> <用户名>          # 修改用户的主组
usermod -G <附加组> <用户名>        # 修改用户的附加组
usermod -s /bin/bash <用户名>       # 修改用户登录的 Shell
usermod -L <用户名>         # 锁定用户
usermod -U <用户名>         # 解锁用户

userdel <用户名>	        # 只删除用户不删除家目录
userdel -r <用户名>	        # 同时删除家目录
userdel -f <用户名>	        # 强制删除,即使用户还在登陆中
sudo passwd                 # 配置 su 密码

chage	# 修改帐号和密码的有效期限
	chage -l <用户名>       # 查看一下用户密码状态
	chage -d <用户名>       # 把密码修改曰期归零了,这样用户一登录就要修改密码

passwd -l <用户名>          # 锁定用户
passwd -u <用户名>          # 解锁用户
```

---

# 组信息

**/etc/group**

`/ect/group` 文件是用户组配置文件，即用户组的所有信息都存放在此文件中。

此文件是记录组 ID（GID）和组名相对应的文件。

```bash
cat /etc/group
root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
...
test:x:1000:
```

此文件中每一行各代表一个用户组。以 "：" 作为字段之间的分隔符，分为 4 个字段

每个字段对应的含义为：组名：密码：GID：该用户组中的用户列表

- 组名

    也就是是用户组的名称，有字母或数字构成。同 /etc/passwd 中的用户名一样，组名也不能重复。

- 组密码

    和 /etc/passwd 文件一样，这里的 "x" 仅仅是密码标识，真正加密后的组密码默认保存在 /etc/gshadow 文件中。

    不过，用户设置密码是为了验证用户的身份，那用户组设置密码是用来做什么的呢？用户组密码主要是用来指定组管理员的，由于系统中的账号可能会非常多，root 用户可能没有时间进行用户的组调整，这时可以给用户组指定组管理员，如果有用户需要加入或退出某用户组，可以由该组的组管理员替代 root 进行管理。但是这项功能目前很少使用，我们也很少设置组密码。如果需要赋予某用户调整某个用户组的权限，则可以使用 sudo 命令代替。

- 组ID (GID)

    就是群组的 ID 号，Linux 系统就是通过 GID 来区分用户组的，同用户名一样，组名也只是为了便于管理员记忆。

    这里的组 GID 与 /etc/passwd 文件中第 4 个字段的 GID 相对应，实际上，/etc/passwd 文件中使用 GID 对应的群组名，就是通过此文件对应得到的。

- 组中的用户

    此字段列出每个群组包含的所有用户。需要注意的是，如果该用户组是这个用户的初始组，则该用户不会写入这个字段，可以这么理解，该字段显示的用户都是这个用户组的附加用户。

    举个例子，lamp 组的组信息为 "lamp:x:502:"，可以看到，第四个字段没有写入 lamp 用户，因为 lamp 组是 lamp 用户的初始组。如果要查询这些用户的初始组，则需要先到 /etc/passwd 文件中查看 GID（第四个字段），然后到 /etc/group 文件中比对组名。

    每个用户都可以加入多个附加组，但是只能属于一个初始组。所以我们在实际工作中，如果需要把用户加入其他组，则需要以附加组的形式添加。例如，我们想让 lamp 也加入 root 这个群组，那么只需要在第一行的最后一个字段加入 lamp，即 root:x:0:lamp 就可以了。

    一般情况下，用户的初始组就是在建立用户的同时建立的和用户名相同的组。

**/etc/gshadow**

`/etc/passwd` 文件存储用户基本信息，同时考虑到账户的安全性，将用户的密码信息存放另一个文件 `/etc/shadow` 中。`/etc/gshadow` 文件也是如此，组用户信息存储在 `/etc/group` 文件中，而将组用户的密码信息存储在 `/etc/gshadow` 文件中。

```bash
root:*::
daemon:*::
bin:*::
sys:*::
...
test:!::
```

文件中，每行代表一个组用户的密码信息，各行信息用 ":" 作为分隔符分为 4 个字段

每个字段的含义如下：组名：加密密码：组管理员：组附加用户列表

- 组名

    同 /etc/group 文件中的组名相对应。

- 组密码

    对于大多数用户来说，通常不设置组密码，因此该字段常为空，但有时为 "!"，指的是该群组没有组密码，也不设有群组管理员。

- 组管理员

    从系统管理员的角度来说，该文件最大的功能就是创建群组管理员。那么，什么是群组管理员呢？

    考虑到 Linux 系统中账号太多，而超级管理员 root 可能比较忙碌，因此当有用户想要加入某群组时，root 或许不能及时作出回应。这种情况下，如果有群组管理员，那么他就能将用户加入自己管理的群组中，也就免去麻烦 root 了。

    不过，由于目前有 sudo 之类的工具，因此群组管理员的这个功能已经很少使用了。

- 组中的附加用户

    该字段显示这个用户组中有哪些附加用户，和 /etc/group 文件中附加组显示内容相同。
